window.OpenSeadragon=window.OpenSeadragon||function(a){return new OpenSeadragon.Viewer(a)},"function"==typeof define&&define.amd&&define(function(){return window.OpenSeadragon}),function(a){a.version={versionStr:"2.2.1",major:parseInt("2",10),minor:parseInt("2",10),revision:parseInt("1",10)};var b={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},c=Object.prototype.toString,d=Object.prototype.hasOwnProperty;a.isFunction=function(b){return"function"===a.type(b)},a.isArray=Array.isArray||function(b){return"array"===a.type(b)},a.isWindow=function(a){return a&&"object"==typeof a&&"setInterval"in a},a.type=function(a){return null===a||void 0===a?String(a):b[c.call(a)]||"object"},a.isPlainObject=function(b){if(!b||"object"!==OpenSeadragon.type(b)||b.nodeType||a.isWindow(b))return!1;if(b.constructor&&!d.call(b,"constructor")&&!d.call(b.constructor.prototype,"isPrototypeOf"))return!1;var c;for(var e in b)c=e;return void 0===c||d.call(b,c)},a.isEmptyObject=function(a){for(var b in a)return!1;return!0},a.freezeObject=function(b){return Object.freeze?a.freezeObject=Object.freeze:a.freezeObject=function(a){return a},a.freezeObject(b)},a.supportsCanvas=function(){var b=document.createElement("canvas");return!(!a.isFunction(b.getContext)||!b.getContext("2d"))}(),a.isCanvasTainted=function(a){var b=!1;try{a.getContext("2d").getImageData(0,0,1,1)}catch(a){b=!0}return b},a.pixelDensityRatio=function(){if(a.supportsCanvas){var b=document.createElement("canvas").getContext("2d");return(window.devicePixelRatio||1)/(b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1)}return 1}()}(OpenSeadragon),function($){function getOffsetParent(a,b){return b&&a!=document.body?document.body:a.offsetParent}$.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=arguments.length,i=!1,j=1;for("boolean"==typeof g&&(i=g,g=arguments[1]||{},j=2),"object"==typeof g||OpenSeadragon.isFunction(g)||(g={}),h===j&&(g=this,--j);j<h;j++)if(null!==(a=arguments[j])||void 0!==a)for(b in a)c=g[b],d=a[b],g!==d&&(i&&d&&(OpenSeadragon.isPlainObject(d)||(e=OpenSeadragon.isArray(d)))?(e?(e=!1,f=c&&OpenSeadragon.isArray(c)?c:[]):f=c&&OpenSeadragon.isPlainObject(c)?c:{},g[b]=OpenSeadragon.extend(i,f,d)):void 0!==d&&(g[b]=d));return g};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var a=navigator.userAgent;return"string"==typeof a&&(-1!==a.indexOf("iPhone")||-1!==a.indexOf("iPad")||-1!==a.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,degrees:0,opacity:1,compositeOperation:null,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:"#437AB2"},SIGNAL:"----seadragon----",delegate:function(a,b){return function(){var c=arguments;return void 0===c&&(c=[]),b.apply(a,c)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(a){return"string"==typeof a&&(a=document.getElementById(a)),a},getElementPosition:function(a){var c,d,b=new $.Point;for(a=$.getElement(a),c="fixed"==$.getElementStyle(a).position,d=getOffsetParent(a,c);d;)b.x+=a.offsetLeft,b.y+=a.offsetTop,c&&(b=b.plus($.getPageScroll())),a=d,c="fixed"==$.getElementStyle(a).position,d=getOffsetParent(a,c);return b},getElementOffset:function(a){a=$.getElement(a);var c,d,b=a&&a.ownerDocument,e={top:0,left:0};return b?(c=b.documentElement,void 0!==a.getBoundingClientRect&&(e=a.getBoundingClientRect()),d=b==b.window?b:9===b.nodeType&&(b.defaultView||b.parentWindow),new $.Point(e.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0),e.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0))):new $.Point},getElementSize:function(a){return a=$.getElement(a),new $.Point(a.clientWidth,a.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(a){return a=$.getElement(a),a.currentStyle}:function(a){return a=$.getElement(a),window.getComputedStyle(a,"")},getCssPropertyWithVendorPrefix:function(a){var b={};return $.getCssPropertyWithVendorPrefix=function(a){if(void 0!==b[a])return b[a];var c=document.createElement("div").style,d=null;if(void 0!==c[a])d=a;else for(var e=["Webkit","Moz","MS","O","webkit","moz","ms","o"],f=$.capitalizeFirstLetter(a),g=0;g<e.length;g++){var h=e[g]+f;if(void 0!==c[h]){d=h;break}}return b[a]=d,d},$.getCssPropertyWithVendorPrefix(a)},capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},pointInElement:function(a,b){a=$.getElement(a);var c=$.getElementOffset(a),d=$.getElementSize(a);return b.x>=c.x&&b.x<c.x+d.x&&b.y<c.y+d.y&&b.y>=c.y},getEvent:function(a){return $.getEvent=a?function(a){return a}:function(){return window.event},$.getEvent(a)},getMousePosition:function(a){if("number"==typeof a.pageX)$.getMousePosition=function(a){var b=new $.Point;return a=$.getEvent(a),b.x=a.pageX,b.y=a.pageY,b};else{if("number"!=typeof a.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(a){var b=new $.Point;return a=$.getEvent(a),b.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,b.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop,b}}return $.getMousePosition(a)},getPageScroll:function(){var a=document.documentElement||{},b=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(b.scrollLeft||b.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!a.scrollLeft&&!a.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(a){if(void 0!==window.scrollTo)$.setPageScroll=function(a){window.scrollTo(a.x,a.y)};else{var b=$.getPageScroll();if(b.x===a.x&&b.y===a.y)return;document.body.scrollLeft=a.x,document.body.scrollTop=a.y;var c=$.getPageScroll();if(c.x!==b.x&&c.y!==b.y)return void($.setPageScroll=function(a){document.body.scrollLeft=a.x,document.body.scrollTop=a.y});if(document.documentElement.scrollLeft=a.x,document.documentElement.scrollTop=a.y,c=$.getPageScroll(),c.x!==b.x&&c.y!==b.y)return void($.setPageScroll=function(a){document.documentElement.scrollLeft=a.x,document.documentElement.scrollTop=a.y});$.setPageScroll=function(a){}}return $.setPageScroll(a)},getWindowSize:function(){var a=document.documentElement||{},b=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(a.clientWidth||a.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!b.clientWidth&&!b.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(a){a=$.getElement(a);var b=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(b[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(b[1].style,{display:"table-row"}),$.extend(b[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),b[0].appendChild(b[1]),b[1].appendChild(b[2]),b[2].appendChild(a),b[0]},makeNeutralElement:function(a){var b=document.createElement(a),c=b.style;return c.background="transparent none",c.border="none",c.margin="0px",c.padding="0px",c.position="static",b},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(a){return $.makeTransparentImage=function(a){var b=$.makeNeutralElement("img");return b.src=a,b},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(a){var b=$.makeNeutralElement("img"),c=null;return c=$.makeNeutralElement("span"),c.style.display="inline-block",b.onload=function(){c.style.width=c.style.width||b.width+"px",c.style.height=c.style.height||b.height+"px",b.onload=null,b=null},b.src=a,c.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='scale')",c}),$.makeTransparentImage(a)},setElementOpacity:function(a,b,c){var d,e;a=$.getElement(a),c&&!$.Browser.alpha&&(b=Math.round(b)),$.Browser.opacity?a.style.opacity=b<1?b:"":b<1?(d=Math.round(100*b),e="alpha(opacity="+d+")",a.style.filter=e):a.style.filter=""},setElementTouchActionNone:function(a){a=$.getElement(a),void 0!==a.style.touchAction?a.style.touchAction="none":void 0!==a.style.msTouchAction&&(a.style.msTouchAction="none")},addClass:function(a,b){a=$.getElement(a),a.className?-1===(" "+a.className+" ").indexOf(" "+b+" ")&&(a.className+=" "+b):a.className=b},indexOf:function(a,b,c){return Array.prototype.indexOf?this.indexOf=function(a,b,c){return a.indexOf(b,c)}:this.indexOf=function(a,b,c){var d,f,e=c||0;if(!a)throw new TypeError;if(0===(f=a.length)||e>=f)return-1;for(e<0&&(e=f-Math.abs(e)),d=e;d<f;d++)if(a[d]===b)return d;return-1},this.indexOf(a,b,c)},removeClass:function(a,b){var c,e,d=[];for(a=$.getElement(a),c=a.className.split(/\s+/),e=0;e<c.length;e++)c[e]&&c[e]!==b&&d.push(c[e]);a.className=d.join(" ")},addEvent:function(){if(window.addEventListener)return function(a,b,c,d){a=$.getElement(a),a.addEventListener(b,c,d)};if(window.attachEvent)return function(a,b,c,d){a=$.getElement(a),a.attachEvent("on"+b,c)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(a,b,c,d){a=$.getElement(a),a.removeEventListener(b,c,d)};if(window.detachEvent)return function(a,b,c,d){a=$.getElement(a),a.detachEvent("on"+b,c)};throw new Error("No known event model.")}(),cancelEvent:function(a){a=$.getEvent(a),a.preventDefault?$.cancelEvent=function(a){a.preventDefault()}:$.cancelEvent=function(a){a=$.getEvent(a),a.cancel=!0,a.returnValue=!1},$.cancelEvent(a)},stopEvent:function(a){a=$.getEvent(a),a.stopPropagation?$.stopEvent=function(a){a.stopPropagation()}:$.stopEvent=function(a){a=$.getEvent(a),a.cancelBubble=!0},$.stopEvent(a)},createCallback:function(a,b){var d,c=[];for(d=2;d<arguments.length;d++)c.push(arguments[d]);return function(){var e,d=c.concat([]);for(e=0;e<arguments.length;e++)d.push(arguments[e]);return b.apply(a,d)}},getUrlParameter:function(a){var b=URLPARAMS[a];return b||null},getUrlProtocol:function(a){var b=a.match(/^([a-z]+:)\/\//i);return null===b?window.location.protocol:b[1].toLowerCase()},createAjaxRequest:function(a){var b;try{b=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(a){b=!1}if(b)window.XMLHttpRequest?$.createAjaxRequest=function(a){return a?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(a)},makeAjaxRequest:function(a,b,c){var d;$.isPlainObject(a)&&(b=a.success,c=a.error,d=a.withCredentials,a=a.url);var e=$.getUrlProtocol(a),f=$.createAjaxRequest("file:"===e);if(!$.isFunction(b))throw new Error("makeAjaxRequest requires a success callback");f.onreadystatechange=function(){4==f.readyState&&(f.onreadystatechange=function(){},200===f.status||0===f.status&&"http:"!==e&&"https:"!==e?b(f):($.console.log("AJAX request returned %d: %s",f.status,a),$.isFunction(c)&&c(f)))},d&&(f.withCredentials=!0);try{f.open("GET",a,!0),f.send(null)}catch(d){var g=d.message,h=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(h&&void 0!==d.number&&-2147024891==d.number&&(g+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",d.name,g),f.onreadystatechange=function(){},window.XDomainRequest){var i=new XDomainRequest;if(i){i.onload=function(a){$.isFunction(b)&&b({responseText:i.responseText,status:200,statusText:"OK"})},i.onerror=function(a){$.isFunction(c)&&c({responseText:i.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{i.open("GET",a),i.send()}catch(a){$.isFunction(c)&&c(f,d)}}}else $.isFunction(c)&&c(f,d)}},jsonp:function(a){var b,c=a.url,d=document.head||document.getElementsByTagName("head")[0]||document.documentElement,e=a.callbackName||"openseadragon"+$.now(),f=window[e],g="$1"+e+"$2",h=a.param||"callback",i=a.callback;c=c.replace(/(\=)\?(&|$)|\?\?/i,g),c+=(/\?/.test(c)?"&":"?")+h+"="+e,window[e]=function(a){if(f)window[e]=f;else try{delete window[e]}catch(a){}i&&$.isFunction(i)&&i(a)},b=document.createElement("script"),void 0===a.async&&!1===a.async||(b.async="async"),a.scriptCharset&&(b.charset=a.scriptCharset),b.src=c,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,d&&b.parentNode&&d.removeChild(b),b=void 0)},d.insertBefore(b,d.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(a){if(window.DOMParser)$.parseXml=function(a){var c;return c=new DOMParser,c.parseFromString(a,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(a){var b=null;return b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a),b}}return $.parseXml(a)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(a){return a=a||"",!!FILEFORMATS[a.toLowerCase()]}}),$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};!function(){var d,b=(navigator.appName,navigator.appVersion),c=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(c.substring(c.indexOf("MSIE")+5,c.indexOf(";",c.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(c.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(c.substring(c.indexOf("Firefox")+8))):c.indexOf("Safari")>=0?($.Browser.vendor=c.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(c.substring(c.substring(0,c.indexOf("Safari")).lastIndexOf("/")+1,c.indexOf("Safari")))):(d=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!==d.exec(c)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(b)}var g,h,i,e=window.location.search.substring(1),f=e.split("&");for(i=0;i<f.length;i++)g=f[i],(h=g.indexOf("="))>0&&(URLPARAMS[g.substring(0,h)]=decodeURIComponent(g.substring(h+1)));$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}();var nullfunction=function(a){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},function(a){var b=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,c=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame;if(b&&c)$.requestAnimationFrame=function(){return b.apply(a,arguments)},$.cancelAnimationFrame=function(){return c.apply(a,arguments)};else{var g,d=[],e=[],f=0;$.requestAnimationFrame=function(a){return d.push([++f,a]),g||(g=setInterval(function(){if(d.length){var a=$.now(),b=e;for(e=d,d=b;e.length;)e.shift()[1](a)}else clearInterval(g),g=void 0},20)),f},$.cancelAnimationFrame=function(a){var b,c;for(b=0,c=d.length;b<c;b+=1)if(d[b][0]===a)return void d.splice(b,1);for(b=0,c=e.length;b<c;b+=1)if(e[b][0]===a)return void e.splice(b,1)}}}(window)}(OpenSeadragon),function(a){var b={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(b.supportsFullScreen=!0,b.getFullScreenElement=function(){return document.fullscreenElement},b.requestFullScreen=function(a){return a.requestFullscreen()},b.exitFullScreen=function(){document.exitFullscreen()},b.fullScreenEventName="fullscreenchange",b.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(b.supportsFullScreen=!0,b.getFullScreenElement=function(){return document.msFullscreenElement},b.requestFullScreen=function(a){return a.msRequestFullscreen()},b.exitFullScreen=function(){document.msExitFullscreen()},b.fullScreenEventName="MSFullscreenChange",b.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(b.supportsFullScreen=!0,b.getFullScreenElement=function(){return document.webkitFullscreenElement},b.requestFullScreen=function(a){return a.webkitRequestFullscreen()},b.exitFullScreen=function(){document.webkitExitFullscreen()},b.fullScreenEventName="webkitfullscreenchange",b.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(b.supportsFullScreen=!0,b.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},b.requestFullScreen=function(a){return a.webkitRequestFullScreen()},b.exitFullScreen=function(){document.webkitCancelFullScreen()},b.fullScreenEventName="webkitfullscreenchange",b.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(b.supportsFullScreen=!0,b.getFullScreenElement=function(){return document.mozFullScreenElement},b.requestFullScreen=function(a){return a.mozRequestFullScreen()},b.exitFullScreen=function(){document.mozCancelFullScreen()},b.fullScreenEventName="mozfullscreenchange",b.fullScreenErrorEventName="mozfullscreenerror"),b.isFullScreen=function(){return null!==b.getFullScreenElement()},b.cancelFullScreen=function(){a.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),b.exitFullScreen()},a.extend(a,b)}(OpenSeadragon),function(a){a.EventSource=function(){this.events={}},a.EventSource.prototype={addOnceHandler:function(a,b,c,d){var e=this;d=d||1;var f=0,g=function(c){f++,f===d&&e.removeHandler(a,g),b(c)};this.addHandler(a,g,c)},addHandler:function(b,c,d){var e=this.events[b];e||(this.events[b]=e=[]),c&&a.isFunction(c)&&(e[e.length]={handler:c,userData:d||null})},removeHandler:function(b,c){var f,d=this.events[b],e=[];if(d&&a.isArray(d)){for(f=0;f<d.length;f++)d[f].handler!==c&&e.push(d[f]);this.events[b]=e}},removeAllHandlers:function(a){if(a)this.events[a]=[];else for(var b in this.events)this.events[b]=[]},getHandler:function(a){var b=this.events[a];return b&&b.length?(b=1===b.length?[b[0]]:Array.apply(null,b),function(a,c){var d,e=b.length;for(d=0;d<e;d++)b[d]&&(c.eventSource=a,c.userData=b[d].userData,b[d].handler(c))}):null},raiseEvent:function(a,b){var c=this.getHandler(a);c&&(b||(b={}),c(this,b))}}}(OpenSeadragon),function(a){function d(b){var e,d=c[b.hash],f=d.activePointersLists.length;for(e=0;e<f;e++)d.activePointersLists[e].captureCount>0&&(a.removeEvent(a.MouseTracker.captureElement,"mousemove",d.mousemovecaptured,!0),a.removeEvent(a.MouseTracker.captureElement,"mouseup",d.mouseupcaptured,!0),a.removeEvent(a.MouseTracker.captureElement,a.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",d.pointermovecaptured,!0),a.removeEvent(a.MouseTracker.captureElement,a.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",d.pointerupcaptured,!0),a.removeEvent(a.MouseTracker.captureElement,"touchmove",d.touchmovecaptured,!0),a.removeEvent(a.MouseTracker.captureElement,"touchend",d.touchendcaptured,!0),d.activePointersLists[e].captureCount=0);for(e=0;e<f;e++)d.activePointersLists.pop()}function e(b){var f,g,e=c[b.hash];if(!e.tracking){for(g=0;g<a.MouseTracker.subscribeEvents.length;g++)f=a.MouseTracker.subscribeEvents[g],a.addEvent(b.element,f,e[f],!1);d(b),e.tracking=!0}}function f(b){var f,g,e=c[b.hash];if(e.tracking){for(g=0;g<a.MouseTracker.subscribeEvents.length;g++)f=a.MouseTracker.subscribeEvents[g],a.removeEvent(b.element,f,e[f],!1);d(b),e.tracking=!1}}function g(b,d){var e=c[b.hash];if("pointerevent"===d)return{upName:a.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:e.pointerupcaptured,moveName:a.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:e.pointermovecaptured};if("mouse"===d)return{upName:"mouseup",upHandler:e.mouseupcaptured,moveName:"mousemove",moveHandler:e.mousemovecaptured};if("touch"===d)return{upName:"touchend",upHandler:e.touchendcaptured,moveName:"touchmove",moveHandler:e.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function h(b,c,d){var f,e=b.getActivePointersListByType(c);e.captureCount+=d||1,1===e.captureCount&&(a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9?b.element.setCapture(!0):(f=g(b,a.MouseTracker.havePointerEvents?"pointerevent":c),pa&&qa(window.top)&&a.addEvent(window.top,f.upName,f.upHandler,!0),a.addEvent(a.MouseTracker.captureElement,f.upName,f.upHandler,!0),a.addEvent(a.MouseTracker.captureElement,f.moveName,f.moveHandler,!0)))}function i(b,c,d){var f,e=b.getActivePointersListByType(c);e.captureCount-=d||1,0===e.captureCount&&(a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9?b.element.releaseCapture():(f=g(b,a.MouseTracker.havePointerEvents?"pointerevent":c),pa&&qa(window.top)&&a.removeEvent(window.top,f.upName,f.upHandler,!0),a.removeEvent(a.MouseTracker.captureElement,f.moveName,f.moveHandler,!0),a.removeEvent(a.MouseTracker.captureElement,f.upName,f.upHandler,!0)))}function j(b){var c;if(a.MouseTracker.unprefixedPointerEvents)c=b.pointerType;else switch(b.pointerType){case 2:c="touch";break;case 3:c="pen";break;case 4:c="mouse";break;default:c=""}return c}function k(b){return a.getMousePosition(b)}function l(a,b){return m(k(a),b)}function m(b,c){var d=a.getElementOffset(c);return b.minus(d)}function n(b,c){return new a.Point((b.x+c.x)/2,(b.y+c.y)/2)}function o(b,c){b.clickHandler&&a.cancelEvent(c)}function p(b,c){b.dblClickHandler&&a.cancelEvent(c)}function q(b,c){b.keyDownHandler&&(c=a.getEvent(c),b.keyDownHandler({eventSource:b,keyCode:c.keyCode?c.keyCode:c.charCode,ctrl:c.ctrlKey,shift:c.shiftKey,alt:c.altKey,meta:c.metaKey,originalEvent:c,preventDefaultAction:!1,userData:b.userData})||a.cancelEvent(c))}function r(b,c){b.keyUpHandler&&(c=a.getEvent(c),b.keyUpHandler({eventSource:b,keyCode:c.keyCode?c.keyCode:c.charCode,ctrl:c.ctrlKey,shift:c.shiftKey,alt:c.altKey,meta:c.metaKey,originalEvent:c,preventDefaultAction:!1,userData:b.userData})||a.cancelEvent(c))}function s(b,c){b.keyHandler&&(c=a.getEvent(c),b.keyHandler({eventSource:b,keyCode:c.keyCode?c.keyCode:c.charCode,ctrl:c.ctrlKey,shift:c.shiftKey,alt:c.altKey,meta:c.metaKey,originalEvent:c,preventDefaultAction:!1,userData:b.userData})||a.cancelEvent(c))}function t(b,c){b.focusHandler&&(c=a.getEvent(c),!1===b.focusHandler({eventSource:b,originalEvent:c,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(c))}function u(b,c){b.blurHandler&&(c=a.getEvent(c),!1===b.blurHandler({eventSource:b,originalEvent:c,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(c))}function v(a,b){x(a,b,b)}function w(b,c){c=a.getEvent(c);var d={target:c.target||c.srcElement,type:"wheel",shiftKey:c.shiftKey||!1,clientX:c.clientX,clientY:c.clientY,pageX:c.pageX?c.pageX:c.clientX,pageY:c.pageY?c.pageY:c.clientY,deltaMode:"MozMousePixelScroll"==c.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==a.MouseTracker.wheelEventName?d.deltaY=-1/a.DEFAULT_SETTINGS.pixelsPerWheelLine*c.wheelDelta:d.deltaY=c.detail,x(b,d,c)}function x(b,c,d){var e=0;e=c.deltaY<0?1:-1,b.scrollHandler&&!1===b.scrollHandler({eventSource:b,pointerType:"mouse",position:l(c,b.element),scroll:e,shift:c.shiftKey,isTouchEvent:!1,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d)}function y(a,b){if(a===b)return!1;for(;b&&b!==a;)b=b.parentNode;return b===a}function z(b,c){c=a.getEvent(c),B(b,c)}function A(b,c){c=a.getEvent(c),c.currentTarget===c.relatedTarget||y(c.currentTarget,c.relatedTarget)||B(b,c)}function B(b,c){ia(b,c,[{id:a.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:k(c),currentTime:a.now()}])}function C(b,c){c=a.getEvent(c),E(b,c)}function D(b,c){c=a.getEvent(c),c.currentTarget===c.relatedTarget||y(c.currentTarget,c.relatedTarget)||E(b,c)}function E(b,c){ja(b,c,[{id:a.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:k(c),currentTime:a.now()}])}function F(b){return a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9?1===b?0:2===b?2:4===b?1:-1:b}function G(b,c){var d;c=a.getEvent(c),d={id:a.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:k(c),currentTime:a.now()},ka(b,c,[d],F(c.button))&&(a.stopEvent(c),h(b,"mouse")),(b.clickHandler||b.dblClickHandler||b.pressHandler||b.dragHandler||b.dragEndHandler)&&a.cancelEvent(c)}function H(a,b){J(a,b)}function I(b,c){J(b,c),a.stopEvent(c)}function J(b,c){var d;c=a.getEvent(c),d={id:a.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:k(c),currentTime:a.now()},la(b,c,[d],F(c.button))&&i(b,"mouse")}function K(a,b){M(a,b)}function L(b,c){M(b,c),a.stopEvent(c)}function M(b,c){var d;c=a.getEvent(c),d={id:a.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:k(c),currentTime:a.now()},ma(b,c,[d])}function N(a,b,c){var d,e=c.getLength(),f=[];for(d=0;d<e;d++)f.push(c.getByIndex(d));f.length>0&&(la(a,b,f,0),c.captureCount=1,i(a,"touch"),ja(a,b,f))}function O(c,d){var e,f,g,l,i=d.changedTouches.length,j=[],m=c.getActivePointersListByType("touch");for(e=a.now(),m.getLength()>d.touches.length-i&&(a.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),N(c,d,m)),f=0;f<i;f++)j.push({id:d.changedTouches[f].identifier,type:"touch",currentPos:k(d.changedTouches[f]),currentTime:e});for(ia(c,d,j),f=0;f<b.length;f++)if(b[f]!==c&&b[f].isTracking()&&y(b[f].element,c.element)){for(l=[],g=0;g<i;g++)l.push({id:d.changedTouches[g].identifier,type:"touch",currentPos:k(d.changedTouches[g]),currentTime:e});ia(b[f],d,l)}ka(c,d,j,0)&&(a.stopEvent(d),h(c,"touch",i)),a.cancelEvent(d)}function P(a,b){R(a,b)}function Q(b,c){R(b,c),a.stopEvent(c)}function R(c,d){var e,f,g,l,h=d.changedTouches.length,j=[];for(e=a.now(),f=0;f<h;f++)j.push({id:d.changedTouches[f].identifier,type:"touch",currentPos:k(d.changedTouches[f]),currentTime:e});for(la(c,d,j,0)&&i(c,"touch",h),ja(c,d,j),f=0;f<b.length;f++)if(b[f]!==c&&b[f].isTracking()&&y(b[f].element,c.element)){for(l=[],g=0;g<h;g++)l.push({id:d.changedTouches[g].identifier,type:"touch",currentPos:k(d.changedTouches[g]),currentTime:e});ja(b[f],d,l)}a.cancelEvent(d)}function S(a,b){U(a,b)}function T(b,c){U(b,c),a.stopEvent(c)}function U(b,c){var d,e=c.changedTouches.length,f=[];for(d=0;d<e;d++)f.push({id:c.changedTouches[d].identifier,type:"touch",currentPos:k(c.changedTouches[d]),currentTime:a.now()});ma(b,c,f),a.cancelEvent(c)}function V(a,b){b.changedTouches.length;N(a,b,a.getActivePointersListByType("touch"))}function W(a,b){return b.stopPropagation(),b.preventDefault(),!1}function X(a,b){return b.stopPropagation(),b.preventDefault(),!1}function Y(b,c){var d;c.currentTarget===c.relatedTarget||y(c.currentTarget,c.relatedTarget)||(d={id:c.pointerId,type:j(c),isPrimary:c.isPrimary,currentPos:k(c),currentTime:a.now()},ia(b,c,[d]))}function Z(b,c){var d;c.currentTarget===c.relatedTarget||y(c.currentTarget,c.relatedTarget)||(d={id:c.pointerId,type:j(c),isPrimary:c.isPrimary,currentPos:k(c),currentTime:a.now()},ja(b,c,[d]))}function $(b,c){var d;d={id:c.pointerId,type:j(c),isPrimary:c.isPrimary,currentPos:k(c),currentTime:a.now()},ka(b,c,[d],c.button)&&(a.stopEvent(c),h(b,d.type)),(b.clickHandler||b.dblClickHandler||b.pressHandler||b.dragHandler||b.dragEndHandler||b.pinchHandler)&&a.cancelEvent(c)}function _(a,b){ba(a,b)}function aa(b,c){b.getActivePointersListByType(j(c)).getById(c.pointerId)&&ba(b,c),a.stopEvent(c)}function ba(b,c){var d;d={id:c.pointerId,type:j(c),isPrimary:c.isPrimary,currentPos:k(c),currentTime:a.now()},la(b,c,[d],c.button)&&i(b,d.type)}function ca(a,b){ea(a,b)}function da(b,c){b.getActivePointersListByType(j(c)).getById(c.pointerId)&&ea(b,c),a.stopEvent(c)}function ea(b,c){var d;d={id:c.pointerId,type:j(c),isPrimary:c.isPrimary,currentPos:k(c),currentTime:a.now()},ma(b,c,[d])}function fa(a,b){var c;c={id:b.pointerId,type:j(b)},na(a,b,[c])}function ga(a,b){return b.hasOwnProperty("isPrimary")||(0===a.getLength()?b.isPrimary=!0:b.isPrimary=!1),b.speed=0,b.direction=0,b.contactPos=b.currentPos,b.contactTime=b.currentTime,b.lastPos=b.currentPos,b.lastTime=b.currentTime,a.add(b)}function ha(a,b){var c,d;return a.getById(b.id)?(c=a.removeById(b.id),b.hasOwnProperty("isPrimary")||(d=a.getPrimary())||(d=a.getByIndex(0))&&(d.isPrimary=!0)):c=a.getLength(),c}function ia(b,c,d){var f,h,i,e=b.getActivePointersListByType(d[0].type),g=d.length;for(f=0;f<g;f++)h=d[f],i=e.getById(h.id),i?(i.insideElement=!0,i.lastPos=i.currentPos,i.lastTime=i.currentTime,i.currentPos=h.currentPos,i.currentTime=h.currentTime,h=i):(h.captured=!1,h.insideElementPressed=!1,h.insideElement=!0,ga(e,h)),b.enterHandler&&!1===b.enterHandler({eventSource:b,pointerType:h.type,position:m(h.currentPos,b.element),buttons:e.buttons,pointers:b.getActivePointerCount(),insideElementPressed:h.insideElementPressed,buttonDownAny:0!==e.buttons,isTouchEvent:"touch"===h.type,originalEvent:c,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(c)}function ja(b,d,e){var h,j,k,g=(c[b.hash],b.getActivePointersListByType(e[0].type)),i=e.length;for(h=0;h<i;h++)j=e[h],k=g.getById(j.id),k&&(k.captured?(k.insideElement=!1,k.lastPos=k.currentPos,k.lastTime=k.currentTime,k.currentPos=j.currentPos,k.currentTime=j.currentTime):ha(g,k),j=k),b.exitHandler&&!1===b.exitHandler({eventSource:b,pointerType:j.type,position:m(j.currentPos,b.element),buttons:g.buttons,pointers:b.getActivePointerCount(),insideElementPressed:!!k&&k.insideElementPressed,buttonDownAny:0!==g.buttons,isTouchEvent:"touch"===j.type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d)}function ka(b,d,e,f){var j,l,o,g=c[b.hash],i=b.getActivePointersListByType(e[0].type),k=e.length;if(void 0!==d.buttons?i.buttons=d.buttons:a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9?0===f?i.buttons+=1:1===f?i.buttons+=4:2===f?i.buttons+=2:3===f?i.buttons+=8:4===f?i.buttons+=16:5===f&&(i.buttons+=32):0===f?i.buttons|=1:1===f?i.buttons|=4:2===f?i.buttons|=2:3===f?i.buttons|=8:4===f?i.buttons|=16:5===f&&(i.buttons|=32),0!==f)return b.nonPrimaryPressHandler&&!1===b.nonPrimaryPressHandler({eventSource:b,pointerType:e[0].type,position:m(e[0].currentPos,b.element),button:f,buttons:i.buttons,isTouchEvent:"touch"===e[0].type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d),!1;for(j=0;j<k;j++)l=e[j],o=i.getById(l.id),o?(o.captured=!0,o.insideElementPressed=!0,o.insideElement=!0,o.contactPos=l.currentPos,o.contactTime=l.currentTime,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=l.currentPos,o.currentTime=l.currentTime,l=o):(l.captured=!0,l.insideElementPressed=!0,l.insideElement=!0,ga(i,l)),i.contacts++,(b.dragHandler||b.dragEndHandler||b.pinchHandler)&&a.MouseTracker.gesturePointVelocityTracker.addPoint(b,l),1===i.contacts?b.pressHandler&&!1===b.pressHandler({eventSource:b,pointerType:l.type,position:m(l.contactPos,b.element),buttons:i.buttons,isTouchEvent:"touch"===l.type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d):2===i.contacts&&b.pinchHandler&&"touch"===l.type&&(g.pinchGPoints=i.asArray(),g.lastPinchDist=g.currentPinchDist=g.pinchGPoints[0].currentPos.distanceTo(g.pinchGPoints[1].currentPos),g.lastPinchCenter=g.currentPinchCenter=n(g.pinchGPoints[0].currentPos,g.pinchGPoints[1].currentPos));return!0}function la(b,d,e,f){var k,l,o,q,r,u,g=c[b.hash],h=b.getActivePointersListByType(e[0].type),p=e.length,s=!1,t=!1;if(void 0!==d.buttons?h.buttons=d.buttons:a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9?0===f?h.buttons-=1:1===f?h.buttons-=4:2===f?h.buttons-=2:3===f?h.buttons-=8:4===f?h.buttons-=16:5===f&&(h.buttons-=32):0===f?h.buttons^=-2:1===f?h.buttons^=-5:2===f?h.buttons^=-3:3===f?h.buttons^=-9:4===f?h.buttons^=-17:5===f&&(h.buttons^=-33),0!==f)return b.nonPrimaryReleaseHandler&&!1===b.nonPrimaryReleaseHandler({eventSource:b,pointerType:e[0].type,position:m(e[0].currentPos,b.element),button:f,buttons:h.buttons,isTouchEvent:"touch"===e[0].type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d),!1;for(o=0;o<p;o++)q=e[o],(r=h.getById(q.id))&&(r.captured&&(r.captured=!1,s=!0,t=!0),r.lastPos=r.currentPos,r.lastTime=r.currentTime,r.currentPos=q.currentPos,r.currentTime=q.currentTime,r.insideElement||ha(h,r),k=r.currentPos,l=r.currentTime,t?(h.contacts--,(b.dragHandler||b.dragEndHandler||b.pinchHandler)&&a.MouseTracker.gesturePointVelocityTracker.removePoint(b,r),0===h.contacts?(b.releaseHandler&&!1===b.releaseHandler({eventSource:b,pointerType:r.type,position:m(k,b.element),buttons:h.buttons,insideElementPressed:r.insideElementPressed,insideElementReleased:r.insideElement,isTouchEvent:"touch"===r.type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d),b.dragEndHandler&&!r.currentPos.equals(r.contactPos)&&!1===b.dragEndHandler({eventSource:b,pointerType:r.type,position:m(r.currentPos,b.element),speed:r.speed,direction:r.direction,shift:d.shiftKey,isTouchEvent:"touch"===r.type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d),(b.clickHandler||b.dblClickHandler)&&r.insideElement&&(u=l-r.contactTime<=b.clickTimeThreshold&&r.contactPos.distanceTo(k)<=b.clickDistThreshold,b.clickHandler&&!1===b.clickHandler({eventSource:b,pointerType:r.type,position:m(r.currentPos,b.element),quick:u,shift:d.shiftKey,isTouchEvent:"touch"===r.type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d),b.dblClickHandler&&u&&(h.clicks++,1===h.clicks?(g.lastClickPos=k,g.dblClickTimeOut=setTimeout(function(){h.clicks=0},b.dblClickTimeThreshold)):2===h.clicks&&(clearTimeout(g.dblClickTimeOut),h.clicks=0,g.lastClickPos.distanceTo(k)<=b.dblClickDistThreshold&&!1===b.dblClickHandler({eventSource:b,pointerType:r.type,position:m(r.currentPos,b.element),shift:d.shiftKey,isTouchEvent:"touch"===r.type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d),g.lastClickPos=null)))):2===h.contacts&&b.pinchHandler&&"touch"===r.type&&(g.pinchGPoints=h.asArray(),g.lastPinchDist=g.currentPinchDist=g.pinchGPoints[0].currentPos.distanceTo(g.pinchGPoints[1].currentPos),g.lastPinchCenter=g.currentPinchCenter=n(g.pinchGPoints[0].currentPos,g.pinchGPoints[1].currentPos))):b.releaseHandler&&!1===b.releaseHandler({eventSource:b,pointerType:r.type,position:m(k,b.element),buttons:h.buttons,insideElementPressed:r.insideElementPressed,insideElementReleased:r.insideElement,isTouchEvent:"touch"===r.type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d));return s}function ma(b,d,e){var h,j,k,l,o,f=c[b.hash],g=b.getActivePointersListByType(e[0].type),i=e.length;for(void 0!==d.buttons&&(g.buttons=d.buttons),h=0;h<i;h++)j=e[h],k=g.getById(j.id),k?(j.hasOwnProperty("isPrimary")&&(k.isPrimary=j.isPrimary),k.lastPos=k.currentPos,k.lastTime=k.currentTime,k.currentPos=j.currentPos,k.currentTime=j.currentTime):(j.captured=!1,j.insideElementPressed=!1,j.insideElement=!0,ga(g,j));b.stopHandler&&"mouse"===e[0].type&&(clearTimeout(b.stopTimeOut),b.stopTimeOut=setTimeout(function(){oa(b,d,e[0].type)},b.stopDelay)),0===g.contacts?b.moveHandler&&!1===b.moveHandler({eventSource:b,pointerType:e[0].type,position:m(e[0].currentPos,b.element),buttons:g.buttons,isTouchEvent:"touch"===e[0].type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d):1===g.contacts?(b.moveHandler&&(k=g.asArray()[0],!1===b.moveHandler({eventSource:b,pointerType:k.type,position:m(k.currentPos,b.element),buttons:g.buttons,isTouchEvent:"touch"===k.type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d)),b.dragHandler&&(k=g.asArray()[0],o=k.currentPos.minus(k.lastPos),!1===b.dragHandler({eventSource:b,pointerType:k.type,position:m(k.currentPos,b.element),buttons:g.buttons,delta:o,speed:k.speed,direction:k.direction,shift:d.shiftKey,isTouchEvent:"touch"===k.type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d))):2===g.contacts&&(b.moveHandler&&(l=g.asArray(),!1===b.moveHandler({eventSource:b,pointerType:l[0].type,position:m(n(l[0].currentPos,l[1].currentPos),b.element),buttons:g.buttons,isTouchEvent:"touch"===l[0].type,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d)),b.pinchHandler&&"touch"===e[0].type&&(o=f.pinchGPoints[0].currentPos.distanceTo(f.pinchGPoints[1].currentPos))!=f.currentPinchDist&&(f.lastPinchDist=f.currentPinchDist,f.currentPinchDist=o,f.lastPinchCenter=f.currentPinchCenter,f.currentPinchCenter=n(f.pinchGPoints[0].currentPos,f.pinchGPoints[1].currentPos),!1===b.pinchHandler({eventSource:b,pointerType:"touch",gesturePoints:f.pinchGPoints,lastCenter:m(f.lastPinchCenter,b.element),center:m(f.currentPinchCenter,b.element),lastDistance:f.lastPinchDist,distance:f.currentPinchDist,shift:d.shiftKey,originalEvent:d,preventDefaultAction:!1,userData:b.userData})&&a.cancelEvent(d)))}function na(a,b,c){la(a,b,c,0),ja(a,b,c)}function oa(a,b,c){a.stopHandler&&a.stopHandler({eventSource:a,pointerType:c,position:l(b,a.element),buttons:a.getActivePointersListByType(c).buttons,isTouchEvent:"touch"===c,originalEvent:b,preventDefaultAction:!1,userData:a.userData})}function qa(a){try{return a.addEventListener&&a.removeEventListener}catch(a){return!1}}var b=[],c={};a.MouseTracker=function(d){b.push(this);var e=arguments;a.isPlainObject(d)||(d={element:e[0],clickTimeThreshold:e[1],clickDistThreshold:e[2]}),this.hash=Math.random(),this.element=a.getElement(d.element),this.clickTimeThreshold=d.clickTimeThreshold||a.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=d.clickDistThreshold||a.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=d.dblClickTimeThreshold||a.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=d.dblClickDistThreshold||a.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=d.userData||null,this.stopDelay=d.stopDelay||50,this.enterHandler=d.enterHandler||null,this.exitHandler=d.exitHandler||null,this.pressHandler=d.pressHandler||null,this.nonPrimaryPressHandler=d.nonPrimaryPressHandler||null,this.releaseHandler=d.releaseHandler||null,this.nonPrimaryReleaseHandler=d.nonPrimaryReleaseHandler||null,this.moveHandler=d.moveHandler||null,this.scrollHandler=d.scrollHandler||null,this.clickHandler=d.clickHandler||null,this.dblClickHandler=d.dblClickHandler||null,this.dragHandler=d.dragHandler||null,this.dragEndHandler=d.dragEndHandler||null,this.pinchHandler=d.pinchHandler||null,this.stopHandler=d.stopHandler||null,this.keyDownHandler=d.keyDownHandler||null,this.keyUpHandler=d.keyUpHandler||null,this.keyHandler=d.keyHandler||null,this.focusHandler=d.focusHandler||null,this.blurHandler=d.blurHandler||null;var f=this;c[this.hash]={click:function(a){o(f,a)},dblclick:function(a){p(f,a)},keydown:function(a){q(f,a)},keyup:function(a){r(f,a)},keypress:function(a){s(f,a)},focus:function(a){t(f,a)},blur:function(a){u(f,a)},wheel:function(a){v(f,a)},mousewheel:function(a){w(f,a)},DOMMouseScroll:function(a){w(f,a)},MozMousePixelScroll:function(a){w(f,a)},mouseenter:function(a){z(f,a)},mouseleave:function(a){C(f,a)},mouseover:function(a){A(f,a)},mouseout:function(a){D(f,a)},mousedown:function(a){G(f,a)},mouseup:function(a){H(f,a)},mouseupcaptured:function(a){I(f,a)},mousemove:function(a){K(f,a)},mousemovecaptured:function(a){L(f,a)},touchstart:function(a){O(f,a)},touchend:function(a){P(f,a)},touchendcaptured:function(a){Q(f,a)},touchmove:function(a){S(f,a)},touchmovecaptured:function(a){T(f,a)},touchcancel:function(a){V(f,a)},gesturestart:function(a){W(f,a)},gesturechange:function(a){X(f,a)},pointerover:function(a){Y(f,a)},MSPointerOver:function(a){Y(f,a)},pointerout:function(a){Z(f,a)},MSPointerOut:function(a){Z(f,a)},pointerdown:function(a){$(f,a)},MSPointerDown:function(a){$(f,a)},pointerup:function(a){_(f,a)},MSPointerUp:function(a){_(f,a)},pointermove:function(a){ca(f,a)},MSPointerMove:function(a){ca(f,a)},pointercancel:function(a){fa(f,a)},MSPointerCancel:function(a){fa(f,a)},pointerupcaptured:function(a){aa(f,a)},pointermovecaptured:function(a){da(f,a)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},d.startDisabled||this.setTracking(!0)},a.MouseTracker.prototype={destroy:function(){var a;for(f(this),this.element=null,a=0;a<b.length;a++)if(b[a]===this){b.splice(a,1);break}c[this.hash]=null,delete c[this.hash]},isTracking:function(){return c[this.hash].tracking},setTracking:function(a){return a?e(this):f(this),this},getActivePointersListByType:function(b){var e,g,d=c[this.hash],f=d.activePointersLists.length;for(e=0;e<f;e++)if(d.activePointersLists[e].type===b)return d.activePointersLists[e];return g=new a.MouseTracker.GesturePointList(b),d.activePointersLists.push(g),g},getActivePointerCount:function(){var b,a=c[this.hash],d=a.activePointersLists.length,e=0;for(b=0;b<d;b++)e+=a.activePointersLists[b].getLength();return e},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},a.MouseTracker.gesturePointVelocityTracker=function(){var b=[],c=0,d=0,e=function(a,b){return a.hash.toString()+b.type+b.id.toString()},f=function(){var c,f,g,i,j,k,e=b.length,h=a.now();for(i=h-d,d=h,c=0;c<e;c++)f=b[c],g=f.gPoint,g.direction=Math.atan2(g.currentPos.y-f.lastPos.y,g.currentPos.x-f.lastPos.x),j=f.lastPos.distanceTo(g.currentPos),f.lastPos=g.currentPos,k=1e3*j/(i+1),g.speed=.75*k+.25*g.speed};return{addPoint:function(g,h){var i=e(g,h);b.push({guid:i,gPoint:h,lastPos:h.currentPos}),1===b.length&&(d=a.now(),c=window.setInterval(f,50))},removePoint:function(a,d){var g,f=e(a,d),h=b.length;for(g=0;g<h;g++)if(b[g].guid===f){b.splice(g,1),0===--h&&window.clearInterval(c);break}}}}(),a.MouseTracker.captureElement=document,a.MouseTracker.wheelEventName=a.Browser.vendor==a.BROWSERS.IE&&a.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",a.MouseTracker.supportsMouseCapture=function(){var b=document.createElement("div");return a.isFunction(b.setCapture)&&a.isFunction(b.releaseCapture)}(),a.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",a.MouseTracker.wheelEventName],"DOMMouseScroll"==a.MouseTracker.wheelEventName&&a.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||a.Browser.vendor!==a.BROWSERS.IE)?(a.MouseTracker.havePointerEvents=!0,a.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),a.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?a.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:a.MouseTracker.maxTouchPoints=0,a.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(a.MouseTracker.havePointerEvents=!0,a.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),a.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?a.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:a.MouseTracker.maxTouchPoints=0,a.MouseTracker.haveMouseEnter=!1):(a.MouseTracker.havePointerEvents=!1,a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9?(a.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),a.MouseTracker.haveMouseEnter=!0):(a.MouseTracker.subscribeEvents.push("mouseover","mouseout"),a.MouseTracker.haveMouseEnter=!1),a.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&a.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&a.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),a.MouseTracker.mousePointerId="legacy-mouse",a.MouseTracker.maxTouchPoints=10),a.MouseTracker.GesturePointList=function(a){this._gPoints=[],this.type=a,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},a.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(a){return this._gPoints.push(a)},removeById:function(a){var b,c=this._gPoints.length;for(b=0;b<c;b++)if(this._gPoints[b].id===a){this._gPoints.splice(b,1);break}return this._gPoints.length},getByIndex:function(a){return a<this._gPoints.length?this._gPoints[a]:null},getById:function(a){var b,c=this._gPoints.length;for(b=0;b<c;b++)if(this._gPoints[b].id===a)return this._gPoints[b];return null},getPrimary:function(a){var b,c=this._gPoints.length;for(b=0;b<c;b++)if(this._gPoints[b].isPrimary)return this._gPoints[b];return null}};var pa=function(){try{return window.self!==window.top}catch(a){return!0}}()}(OpenSeadragon),function(a){a.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},a.Control=function(b,c,d){var e=b.parentNode;"number"==typeof c&&(a.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),c={anchor:c}),c.attachToViewer=void 0===c.attachToViewer||c.attachToViewer,this.autoFade=void 0===c.autoFade||c.autoFade,this.element=b,this.anchor=c.anchor,this.container=d,this.anchor==a.ControlAnchor.ABSOLUTE?(this.wrapper=a.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof c.top?c.top+"px":c.top,this.wrapper.style.left="number"==typeof c.left?c.left+"px":c.left,this.wrapper.style.height="number"==typeof c.height?c.height+"px":c.height,this.wrapper.style.width="number"==typeof c.width?c.width+"px":c.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=a.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==a.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),c.attachToViewer?this.anchor==a.ControlAnchor.TOP_RIGHT||this.anchor==a.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):e.appendChild(this.wrapper)},a.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(b){this.wrapper.style.display=b?this.anchor==a.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(b){this.element[a.SIGNAL]&&a.Browser.vendor==a.BROWSERS.IE?a.setElementOpacity(this.element,b,!0):a.setElementOpacity(this.wrapper,b,!0)}}}(OpenSeadragon),function(a){function b(a,b){var d,c=a.controls;for(d=c.length-1;d>=0;d--)if(c[d].element==b)return d;return-1}a.ControlDock=function(b){var d,e,c=["topleft","topright","bottomright","bottomleft"];for(a.extend(!0,this,{id:"controldock-"+a.now()+"-"+Math.floor(1e6*Math.random()),container:a.makeNeutralElement("div"),controls:[]},b),this.container.onsubmit=function(){return!1},this.element&&(this.element=a.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),e=0;e<c.length;e++)d=c[e],this.controls[d]=a.makeNeutralElement("div"),this.controls[d].style.position="absolute",d.match("left")&&(this.controls[d].style.left="0px"),d.match("right")&&(this.controls[d].style.right="0px"),d.match("top")&&(this.controls[d].style.top="0px"),d.match("bottom")&&(this.controls[d].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},a.ControlDock.prototype={addControl:function(c,d){c=a.getElement(c);var e=null;if(!(b(this,c)>=0)){switch(d.anchor){case a.ControlAnchor.TOP_RIGHT:e=this.controls.topright,c.style.position="relative",c.style.paddingRight="0px",c.style.paddingTop="0px";break;case a.ControlAnchor.BOTTOM_RIGHT:e=this.controls.bottomright,c.style.position="relative",c.style.paddingRight="0px",c.style.paddingBottom="0px";break;case a.ControlAnchor.BOTTOM_LEFT:e=this.controls.bottomleft,c.style.position="relative",c.style.paddingLeft="0px",c.style.paddingBottom="0px";break;case a.ControlAnchor.TOP_LEFT:e=this.controls.topleft,c.style.position="relative",c.style.paddingLeft="0px",c.style.paddingTop="0px";break;case a.ControlAnchor.ABSOLUTE:e=this.container,c.style.margin="0px",c.style.padding="0px";break;default:case a.ControlAnchor.NONE:e=this.container,c.style.margin="0px",c.style.padding="0px"}this.controls.push(new a.Control(c,d,e)),c.style.display="inline-block"}},removeControl:function(c){c=a.getElement(c);var d=b(this,c);return d>=0&&(this.controls[d].destroy(),this.controls.splice(d,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var a;for(a=this.controls.length-1;a>=0;a--)if(this.controls[a].isVisible())return!0;return!1},setControlsEnabled:function(a){var b;for(b=this.controls.length-1;b>=0;b--)this.controls[b].setVisible(a);return this}}}(OpenSeadragon),function(a){a.Placement=a.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(a){function d(b){return b=a.getElement(b),new a.Point(0===b.clientWidth?1:b.clientWidth,0===b.clientHeight?1:b.clientHeight)}function e(b,c,d,e){function g(a,b){a.ready?d(a):(a.addHandler("ready",function(){d(a)}),a.addHandler("open-failed",function(a){e({message:a.message,source:b})}))}var f=b;"string"==a.type(c)&&(c.match(/\s*<.*/)?c=a.parseXml(c):c.match(/\s*[\{\[].*/)&&(c=a.parseJSON(c))),setTimeout(function(){if("string"==a.type(c))c=new a.TileSource({url:c,crossOriginPolicy:b.crossOriginPolicy,ajaxWithCredentials:b.ajaxWithCredentials,useCanvas:b.useCanvas,success:function(a){d(a.tileSource)}}),c.addHandler("open-failed",function(a){e(a)});else if(a.isPlainObject(c)||c.nodeType)if(!c.crossOriginPolicy&&b.crossOriginPolicy&&(c.crossOriginPolicy=b.crossOriginPolicy),void 0===c.ajaxWithCredentials&&(c.ajaxWithCredentials=b.ajaxWithCredentials),void 0===c.useCanvas&&(c.useCanvas=b.useCanvas),a.isFunction(c.getTileUrl)){var h=new a.TileSource(c);h.getTileUrl=c.getTileUrl,d(h)}else{var i=a.TileSource.determineType(f,c);if(!i)return void e({message:"Unable to load TileSource",source:c});var j=i.prototype.configure.apply(f,[c]);g(new i(j),c)}else g(c,c)})}function f(b,c){if(c instanceof a.Overlay)return c;var d=null;if(c.element)d=a.getElement(c.element);else{var e=c.id?c.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());d=a.getElement(c.id),d||(d=document.createElement("a"),d.href="#/overlay/"+e),d.id=e,a.addClass(d,c.className?c.className:"openseadragon-overlay")}var f=c.location,g=c.width,h=c.height;if(!f){var i=c.x,j=c.y;if(void 0!==c.px){var k=b.viewport.imageToViewportRectangle(new a.Rect(c.px,c.py,g||0,h||0));i=k.x,j=k.y,g=void 0!==g?k.width:void 0,h=void 0!==h?k.height:void 0}f=new a.Point(i,j)}var l=c.placement;return l&&"string"===a.type(l)&&(l=a.Placement[c.placement.toUpperCase()]),new a.Overlay({element:d,location:f,placement:l,onDraw:c.onDraw,checkResize:c.checkResize,width:g,height:h,rotationMode:c.rotationMode})}function g(a,b){var c;for(c=a.length-1;c>=0;c--)if(a[c].element===b)return c;return-1}function h(b,c){return a.requestAnimationFrame(function(){c(b)})}function i(b){a.requestAnimationFrame(function(){k(b)})}function j(b){b.autoHideControls&&(b.controlsShouldFade=!0,b.controlsFadeBeginTime=a.now()+b.controlsFadeDelay,window.setTimeout(function(){i(b)},b.controlsFadeDelay))}function k(b){var c,d,e,f;if(b.controlsShouldFade){for(c=a.now(),d=c-b.controlsFadeBeginTime,e=1-d/b.controlsFadeLength,e=Math.min(1,e),e=Math.max(0,e),f=b.controls.length-1;f>=0;f--)b.controls[f].autoFade&&b.controls[f].setOpacity(e);e>0&&i(b)}}function l(a){var b;for(a.controlsShouldFade=!1,b=a.controls.length-1;b>=0;b--)a.controls[b].setOpacity(1)}function m(){l(this)}function n(){j(this)}function o(b){if(b.preventDefaultAction||b.ctrl||b.alt||b.meta)return!0;switch(b.keyCode){case 38:return b.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,-40))),this.viewport.applyConstraints(),!1;case 40:return b.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,40))),this.viewport.applyConstraints(),!1;case 37:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(-40,0))),this.viewport.applyConstraints(),!1;case 39:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0}}function p(b){if(b.preventDefaultAction||b.ctrl||b.alt||b.meta)return!0;switch(b.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return b.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,-40))),this.viewport.applyConstraints(),!1;case 115:case 83:return b.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,40))),this.viewport.applyConstraints(),!1;case 97:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(-40,0))),this.viewport.applyConstraints(),!1;case 100:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0}}function q(a){var b;document.activeElement==this.canvas||this.canvas.focus(),!a.preventDefaultAction&&this.viewport&&a.quick&&(b=this.gestureSettingsByDeviceType(a.pointerType),b.clickToZoom&&(this.viewport.zoomBy(a.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(a.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-click",{tracker:a.eventSource,position:a.position,quick:a.quick,shift:a.shift,originalEvent:a.originalEvent})}function r(a){var b;!a.preventDefaultAction&&this.viewport&&(b=this.gestureSettingsByDeviceType(a.pointerType),b.dblClickToZoom&&(this.viewport.zoomBy(a.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(a.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-double-click",{tracker:a.eventSource,position:a.position,shift:a.shift,originalEvent:a.originalEvent})}function s(a){var b;!a.preventDefaultAction&&this.viewport&&(b=this.gestureSettingsByDeviceType(a.pointerType),this.panHorizontal||(a.delta.x=0),this.panVertical||(a.delta.y=0),this.viewport.panBy(this.viewport.deltaPointsFromPixels(a.delta.negate()),b.flickEnabled),this.constrainDuringPan&&this.viewport.applyConstraints()),this.raiseEvent("canvas-drag",{tracker:a.eventSource,position:a.position,delta:a.delta,speed:a.speed,direction:a.direction,shift:a.shift,originalEvent:a.originalEvent})}function t(b){if(!b.preventDefaultAction&&this.viewport){var c=this.gestureSettingsByDeviceType(b.pointerType);if(c.flickEnabled&&b.speed>=c.flickMinSpeed){var d=0;this.panHorizontal&&(d=c.flickMomentum*b.speed*Math.cos(b.direction));var e=0;this.panVertical&&(e=c.flickMomentum*b.speed*Math.sin(b.direction));var f=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),g=this.viewport.pointFromPixel(new a.Point(f.x-d,f.y-e));this.viewport.panTo(g,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:b.eventSource,position:b.position,speed:b.speed,direction:b.direction,shift:b.shift,originalEvent:b.originalEvent})}function u(a){this.raiseEvent("canvas-enter",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function v(a){this.raiseEvent("canvas-exit",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function w(a){this.raiseEvent("canvas-press",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,insideElementPressed:a.insideElementPressed,insideElementReleased:a.insideElementReleased,originalEvent:a.originalEvent})}function x(a){this.raiseEvent("canvas-release",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,insideElementPressed:a.insideElementPressed,insideElementReleased:a.insideElementReleased,originalEvent:a.originalEvent})}function y(a){this.raiseEvent("canvas-nonprimary-press",{tracker:a.eventSource,position:a.position,pointerType:a.pointerType,button:a.button,buttons:a.buttons,originalEvent:a.originalEvent})}function z(a){this.raiseEvent("canvas-nonprimary-release",{tracker:a.eventSource,position:a.position,pointerType:a.pointerType,button:a.button,buttons:a.buttons,originalEvent:a.originalEvent})}function A(a){var b,c,d,e;if(!a.preventDefaultAction&&this.viewport&&(b=this.gestureSettingsByDeviceType(a.pointerType),b.pinchToZoom&&(c=this.viewport.pointFromPixel(a.center,!0),d=this.viewport.pointFromPixel(a.lastCenter,!0),e=d.minus(c),this.panHorizontal||(e.x=0),this.panVertical||(e.y=0),this.viewport.zoomBy(a.distance/a.lastDistance,c,!0),this.viewport.panBy(e,!0),this.viewport.applyConstraints()),b.pinchRotate)){var f=Math.atan2(a.gesturePoints[0].currentPos.y-a.gesturePoints[1].currentPos.y,a.gesturePoints[0].currentPos.x-a.gesturePoints[1].currentPos.x),g=Math.atan2(a.gesturePoints[0].lastPos.y-a.gesturePoints[1].lastPos.y,a.gesturePoints[0].lastPos.x-a.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(f-g)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:a.eventSource,gesturePoints:a.gesturePoints,lastCenter:a.lastCenter,center:a.center,lastDistance:a.lastDistance,distance:a.distance,shift:a.shift,originalEvent:a.originalEvent}),!1}function B(b){var c,d,e;if(e=a.now(),e-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=e,!b.preventDefaultAction&&this.viewport&&(c=this.gestureSettingsByDeviceType(b.pointerType),c.scrollToZoom&&(d=Math.pow(this.zoomPerScroll,b.scroll),this.viewport.zoomBy(d,this.viewport.pointFromPixel(b.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:b.eventSource,position:b.position,scroll:b.scroll,shift:b.shift,originalEvent:b.originalEvent}),c&&c.scrollToZoom)return!1}else if((c=this.gestureSettingsByDeviceType(b.pointerType))&&c.scrollToZoom)return!1}function C(a){b[this.hash].mouseInside=!0,l(this),this.raiseEvent("container-enter",{tracker:a.eventSource,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function D(a){a.pointers<1&&(b[this.hash].mouseInside=!1,b[this.hash].animating||j(this)),this.raiseEvent("container-exit",{tracker:a.eventSource,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function E(a){F(a),a.isOpen()?a._updateRequestId=h(a,E):a._updateRequestId=!1}function F(a){if(!a._opening){if(a.autoResize){var c=d(a.container),e=b[a.hash].prevContainerSize;if(!c.equals(e)){var f=a.viewport;if(a.preserveImageSizeOnResize){var g=e.x/c.x,h=f.getZoom()*g,i=f.getCenter();f.resize(c,!1),f.zoomTo(h,null,!0),f.panTo(i,!0)}else{var k=f.getBounds();f.resize(c,!0),f.fitBoundsWithConstraints(k,!0)}b[a.hash].prevContainerSize=c,b[a.hash].forceRedraw=!0}}var m=a.viewport.update(),n=a.world.update()||m;m&&a.raiseEvent("viewport-change"),a.referenceStrip&&(n=a.referenceStrip.update(a.viewport)||n),!b[a.hash].animating&&n&&(a.raiseEvent("animation-start"),l(a)),(n||b[a.hash].forceRedraw||a.world.needsDraw())&&(G(a),a._drawOverlays(),a.navigator&&a.navigator.update(a.viewport),b[a.hash].forceRedraw=!1,n&&a.raiseEvent("animation")),b[a.hash].animating&&!n&&(a.raiseEvent("animation-finish"),b[a.hash].mouseInside||j(a)),b[a.hash].animating=n}}function G(a){a.imageLoader.clear(),a.drawer.clear(),a.world.draw(),a.raiseEvent("update-viewport",{})}function H(a,b){return a?a+b:b}function I(){b[this.hash].lastZoomTime=a.now(),b[this.hash].zoomFactor=this.zoomPerSecond,b[this.hash].zooming=!0,L(this)}function J(){b[this.hash].lastZoomTime=a.now(),b[this.hash].zoomFactor=1/this.zoomPerSecond,b[this.hash].zooming=!0,L(this)}function K(){b[this.hash].zooming=!1}function L(b){a.requestAnimationFrame(a.delegate(b,M))}function M(){var c,d,e;b[this.hash].zooming&&this.viewport&&(c=a.now(),d=c-b[this.hash].lastZoomTime,e=Math.pow(b[this.hash].zoomFactor,d/1e3),this.viewport.zoomBy(e),this.viewport.applyConstraints(),b[this.hash].lastZoomTime=c,L(this))}function N(){this.viewport&&(b[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function O(){this.viewport&&(b[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function P(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function Q(){this.viewport&&this.viewport.goHome()}function R(){this.isFullPage()&&!a.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function S(){if(this.viewport){var a=this.viewport.getRotation();0===a?a=270:a-=90,this.viewport.setRotation(a)}}function T(){if(this.viewport){var a=this.viewport.getRotation();270===a?a=0:a+=90,this.viewport.setRotation(a)}}function U(){var a=this._sequenceIndex-1;this.navPrevNextWrap&&a<0&&(a+=this.tileSources.length),this.goToPage(a)}function V(){var a=this._sequenceIndex+1;this.navPrevNextWrap&&a>=this.tileSources.length&&(a=0),this.goToPage(a)}var b={},c=1;a.Viewer=function(e){var i,f=arguments,g=this;if(a.isPlainObject(e)||(e={id:f[0],xmlPath:f.length>1?f[1]:void 0,prefixUrl:f.length>2?f[2]:void 0,controls:f.length>3?f[3]:void 0,overlays:f.length>4?f[4]:void 0}),e.config&&(a.extend(!0,e,e.config),delete e.config),a.extend(!0,this,{id:e.id,hash:e.hash||c++,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},a.DEFAULT_SETTINGS,e),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==b[this.hash]&&a.console.warn("Hash "+this.hash+" has already been used."),b[this.hash]={fsBoundsDelta:new a.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=a.now(),a.EventSource.call(this),this.addHandler("open-failed",function(b){var c=a.getString("Errors.OpenFailed",b.eventSource,b.message);g._showMessage(c)}),a.ControlDock.call(this,e),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=a.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(a){a.width="100%",a.height="100%",a.overflow="hidden",a.position="absolute",a.top="0px",a.left="0px"}(this.canvas.style),a.setElementTouchActionNone(this.canvas),""!==e.tabIndex&&(this.canvas.tabIndex=void 0===e.tabIndex?0:e.tabIndex),this.container.className="openseadragon-container",function(a){a.width="100%",a.height="100%",a.position="relative",a.overflow="hidden",a.left="0px",a.top="0px",a.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new a.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:a.delegate(this,o),keyHandler:a.delegate(this,p),clickHandler:a.delegate(this,q),dblClickHandler:a.delegate(this,r),dragHandler:a.delegate(this,s),dragEndHandler:a.delegate(this,t),enterHandler:a.delegate(this,u),exitHandler:a.delegate(this,v),pressHandler:a.delegate(this,w),releaseHandler:a.delegate(this,x),nonPrimaryPressHandler:a.delegate(this,y),nonPrimaryReleaseHandler:a.delegate(this,z),scrollHandler:a.delegate(this,B),pinchHandler:a.delegate(this,A)}),this.outerTracker=new a.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:a.delegate(this,C),exitHandler:a.delegate(this,D)}),this.toolbar&&(this.toolbar=new a.ControlDock({element:this.toolbar})),this.bindStandardControls(),b[this.hash].prevContainerSize=d(this.container),this.world=new a.World({viewer:this}),this.world.addHandler("add-item",function(a){g.source=g.world.getItemAt(0).source,b[g.hash].forceRedraw=!0,g._updateRequestId||(g._updateRequestId=h(g,E))}),this.world.addHandler("remove-item",function(a){g.world.getItemCount()?g.source=g.world.getItemAt(0).source:g.source=null,b[g.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(a){g.viewport&&g.viewport._setContentBounds(g.world.getHomeBounds(),g.world.getContentFactor())}),this.world.addHandler("item-index-change",function(a){g.source=g.world.getItemAt(0).source}),this.viewport=new a.Viewport({containerSize:b[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new a.ImageLoader({jobLimit:this.imageLoaderLimit}),this.tileCache=new a.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new a.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=a.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(i=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(i,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(i=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(i,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new a.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),i=0;i<this.customControls.length;i++)this.addControl(this.customControls[i].id,{anchor:this.customControls[i].anchor});a.requestAnimationFrame(function(){j(g)})},a.extend(a.Viewer.prototype,a.EventSource.prototype,a.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(b){return a.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(b)},openTileSource:function(b){return a.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(b)},open:function(b){var c=this;if(this.close(),b){if(this.sequenceMode&&a.isArray(b))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this.tileSources=b,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&(this.referenceStrip=new a.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}))),void this._updateSequenceButtons(this._sequenceIndex);if(a.isArray(b)||(b=[b]),b.length){this._opening=!0;for(var h,d=b.length,e=0,g=0,i=function(){if(e+g===d)if(e){!c._firstOpen&&c.preserveViewport||(c.viewport.goHome(!0),c.viewport.update()),c._firstOpen=!1;var a=b[0];if(a.tileSource&&(a=a.tileSource),c.overlays&&!c.preserveOverlays)for(var i=0;i<c.overlays.length;i++)c.currentOverlays[i]=f(c,c.overlays[i]);c._drawOverlays(),c._opening=!1,c.raiseEvent("open",{source:a})}else c._opening=!1,c.raiseEvent("open-failed",h)},j=function(b){a.isPlainObject(b)&&b.tileSource||(b={tileSource:b}),void 0!==b.index&&(a.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete b.index),void 0===b.collectionImmediately&&(b.collectionImmediately=!0);var d=b.success;b.success=function(a){if(e++,b.tileSource.overlays)for(var f=0;f<b.tileSource.overlays.length;f++)c.addOverlay(b.tileSource.overlays[f]);d&&d(a),i()};var f=b.error;b.error=function(a){g++,h||(h=a),f&&f(a),i()},c.addTiledImage(b)},k=0;k<b.length;k++)j(b[k]);return this}}},close:function(){return b[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),b[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(b[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(a.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),b[this.hash]=null,delete b[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(a){return this.innerTracker.setTracking(a),this.outerTracker.setTracking(a),this.raiseEvent("mouse-enabled",{enabled:a}),this},areControlsEnabled:function(){var b,a=this.controls.length;for(b=0;b<this.controls.length;b++)a=a&&this.controls[b].isVisibile();return a},setControlsEnabled:function(a){return a?l(this):j(this),this.raiseEvent("controls-enabled",{enabled:a}),this},isFullPage:function(){return b[this.hash].fullPage},setFullPage:function(c){var i,j,d=document.body,e=d.style,f=document.documentElement.style,g=this;if(c==this.isFullPage())return this;var k={fullPage:c,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",k),k.preventDefaultAction)return this;if(c){for(this.elementSize=a.getElementSize(this.element),this.pageScroll=a.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=e.margin,this.docMargin=f.margin,e.margin="0",f.margin="0",this.bodyPadding=e.padding,this.docPadding=f.padding,e.padding="0",f.padding="0",this.bodyWidth=e.width,this.docWidth=f.width,e.width="100%",f.width="100%",this.bodyHeight=e.height,this.docHeight=f.height,e.height="100%",f.height="100%",this.previousBody=[],b[this.hash].prevElementParent=this.element.parentNode,b[this.hash].prevNextSibling=this.element.nextSibling,b[this.hash].prevElementWidth=this.element.style.width,b[this.hash].prevElementHeight=this.element.style.height,i=d.childNodes.length,j=0;j<i;j++)this.previousBody.push(d.childNodes[0]),d.removeChild(d.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,d.appendChild(this.toolbar.element),a.addClass(this.toolbar.element,"fullpage")),a.addClass(this.element,"fullpage"),d.appendChild(this.element),this.element.style.height=a.getWindowSize().y+"px",this.element.style.width=a.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=a.getElementSize(this.element).y-a.getElementSize(this.toolbar.element).y+"px"),b[this.hash].fullPage=!0,a.delegate(this,C)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,e.margin=this.bodyMargin,f.margin=this.docMargin,e.padding=this.bodyPadding,f.padding=this.docPadding,e.width=this.bodyWidth,f.width=this.docWidth,e.height=this.bodyHeight,f.height=this.docHeight,d.removeChild(this.element),i=this.previousBody.length,j=0;j<i;j++)d.appendChild(this.previousBody.shift());a.removeClass(this.element,"fullpage"),b[this.hash].prevElementParent.insertBefore(this.element,b[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(d.removeChild(this.toolbar.element),a.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=b[this.hash].prevElementWidth,this.element.style.height=b[this.hash].prevElementHeight;var l=0,m=function(){a.setPageScroll(g.pageScroll);var b=a.getPageScroll();(++l<10&&b.x!==g.pageScroll.x||b.y!==g.pageScroll.y)&&a.requestAnimationFrame(m)};a.requestAnimationFrame(m),b[this.hash].fullPage=!1,a.delegate(this,D)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:c}),this},setFullScreen:function(b){var c=this;if(!a.supportsFullScreen)return this.setFullPage(b);if(a.isFullScreen()===b)return this;var d={fullScreen:b,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",d),d.preventDefaultAction)return this;if(b){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var e=function(){var b=a.isFullScreen();b||(a.removeEvent(document,a.fullScreenEventName,e),a.removeEvent(document,a.fullScreenErrorEventName,e),c.setFullPage(!1),c.isFullPage()&&(c.element.style.width=c.fullPageStyleWidth,c.element.style.height=c.fullPageStyleHeight)),c.navigator&&c.viewport&&c.navigator.update(c.viewport),c.raiseEvent("full-screen",{fullScreen:b})};a.addEvent(document,a.fullScreenEventName,e),a.addEvent(document,a.fullScreenErrorEventName,e),a.requestFullScreen(document.body)}else a.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(a){return this.container.style.visibility=a?"":"hidden",this.raiseEvent("visible",{visible:a}),this},addTiledImage:function(b){function f(a){for(var e=0;e<c._loadQueue.length;e++)if(c._loadQueue[e]===d){c._loadQueue.splice(e,1);break}0===c._loadQueue.length&&g(d),c.raiseEvent("add-item-failed",a),b.error&&b.error(a)}function g(a){c.collectionMode&&(c.world.arrange({immediately:a.options.collectionImmediately,rows:c.collectionRows,columns:c.collectionColumns,layout:c.collectionLayout,tileSize:c.collectionTileSize,tileMargin:c.collectionTileMargin}),c.world.setAutoRefigureSizes(!0))}a.console.assert(b,"[Viewer.addTiledImage] options is required"),a.console.assert(b.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),a.console.assert(!b.replace||b.index>-1&&b.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var c=this;b.replace&&(b.replaceItem=c.world.getItemAt(b.index)),this._hideMessage(),void 0===b.placeholderFillStyle&&(b.placeholderFillStyle=this.placeholderFillStyle),void 0===b.opacity&&(b.opacity=this.opacity),void 0===b.compositeOperation&&(b.compositeOperation=this.compositeOperation);var d={options:b};if(a.isArray(b.tileSource))return void setTimeout(function(){f({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:b.tileSource,options:b})});this._loadQueue.push(d),e(this,b.tileSource,function(b){d.tileSource=b;for(var e,f,h;c._loadQueue.length&&(e=c._loadQueue[0],e.tileSource);){if(c._loadQueue.splice(0,1),e.options.replace){var i=c.world.getIndexOfItem(e.options.replaceItem);-1!=i&&(e.options.index=i),c.world.removeItem(e.options.replaceItem)}f=new a.TiledImage({viewer:c,source:e.tileSource,viewport:c.viewport,drawer:c.drawer,tileCache:c.tileCache,imageLoader:c.imageLoader,x:e.options.x,y:e.options.y,width:e.options.width,height:e.options.height,fitBounds:e.options.fitBounds,fitBoundsPlacement:e.options.fitBoundsPlacement,clip:e.options.clip,placeholderFillStyle:e.options.placeholderFillStyle,opacity:e.options.opacity,compositeOperation:e.options.compositeOperation,springStiffness:c.springStiffness,animationTime:c.animationTime,minZoomImageRatio:c.minZoomImageRatio,wrapHorizontal:c.wrapHorizontal,wrapVertical:c.wrapVertical,immediateRender:c.immediateRender,blendTime:c.blendTime,alwaysBlend:c.alwaysBlend,minPixelRatio:c.minPixelRatio,smoothTileEdgesMinZoom:c.smoothTileEdgesMinZoom,iOSDevice:c.iOSDevice,crossOriginPolicy:c.crossOriginPolicy,debugMode:c.debugMode}),c.collectionMode&&c.world.setAutoRefigureSizes(!1),c.world.addItem(f,{index:e.options.index}),0===c._loadQueue.length&&g(e),1!==c.world.getItemCount()||c.preserveViewport||c.viewport.goHome(!0),c.navigator&&(h=a.extend({},e.options,{replace:!1,originalTiledImage:f,tileSource:e.tileSource}),c.navigator.addTiledImage(h)),e.options.success&&e.options.success({item:f})}},function(a){a.options=b,f(a)})},addSimpleImage:function(b){a.console.assert(b,"[Viewer.addSimpleImage] options is required"),a.console.assert(b.url,"[Viewer.addSimpleImage] options.url is required");var c=a.extend({},b,{tileSource:{type:"image",url:b.url}});delete c.url,this.addTiledImage(c)},addLayer:function(b){var c=this;a.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var d=a.extend({},b,{success:function(a){c.raiseEvent("add-layer",{options:b,drawer:a.item})},error:function(a){c.raiseEvent("add-layer-failed",a)}});return this.addTiledImage(d),this},getLayerAtLevel:function(b){return a.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(b)},getLevelOfLayer:function(b){return a.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(b)},getLayersCount:function(){return a.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(b,c){return a.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(b,c)},removeLayer:function(b){return a.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(b)},forceRedraw:function(){return b[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var b=a.delegate(this,m),c=a.delegate(this,n),d=a.delegate(this,V),e=a.delegate(this,U),f=this.navImages,g=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(g=!1),this.previousButton=new a.Button({element:this.previousButton?a.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.PreviousPage"),srcRest:H(this.prefixUrl,f.previous.REST),srcGroup:H(this.prefixUrl,f.previous.GROUP),srcHover:H(this.prefixUrl,f.previous.HOVER),srcDown:H(this.prefixUrl,f.previous.DOWN),onRelease:e,onFocus:b,onBlur:c}),this.nextButton=new a.Button({element:this.nextButton?a.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.NextPage"),srcRest:H(this.prefixUrl,f.next.REST),srcGroup:H(this.prefixUrl,f.next.GROUP),srcHover:H(this.prefixUrl,f.next.HOVER),srcDown:H(this.prefixUrl,f.next.DOWN),onRelease:d,onFocus:b,onBlur:c}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),g&&(this.paging=new a.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:a.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||a.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var b=a.delegate(this,I),c=a.delegate(this,K),d=a.delegate(this,N),e=a.delegate(this,J),f=a.delegate(this,O),g=a.delegate(this,Q),h=a.delegate(this,R),i=a.delegate(this,S),j=a.delegate(this,T),k=a.delegate(this,m),l=a.delegate(this,n),o=this.navImages,p=[],q=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton)&&(q=!1),this.showZoomControl&&(p.push(this.zoomInButton=new a.Button({element:this.zoomInButton?a.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.ZoomIn"),srcRest:H(this.prefixUrl,o.zoomIn.REST),srcGroup:H(this.prefixUrl,o.zoomIn.GROUP),srcHover:H(this.prefixUrl,o.zoomIn.HOVER),srcDown:H(this.prefixUrl,o.zoomIn.DOWN),onPress:b,onRelease:c,onClick:d,onEnter:b,onExit:c,onFocus:k,onBlur:l})),p.push(this.zoomOutButton=new a.Button({element:this.zoomOutButton?a.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.ZoomOut"),srcRest:H(this.prefixUrl,o.zoomOut.REST),srcGroup:H(this.prefixUrl,o.zoomOut.GROUP),srcHover:H(this.prefixUrl,o.zoomOut.HOVER),srcDown:H(this.prefixUrl,o.zoomOut.DOWN),onPress:e,onRelease:c,onClick:f,onEnter:e,onExit:c,onFocus:k,onBlur:l}))),this.showHomeControl&&p.push(this.homeButton=new a.Button({element:this.homeButton?a.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.Home"),srcRest:H(this.prefixUrl,o.home.REST),srcGroup:H(this.prefixUrl,o.home.GROUP),srcHover:H(this.prefixUrl,o.home.HOVER),srcDown:H(this.prefixUrl,o.home.DOWN),onRelease:g,onFocus:k,onBlur:l})),this.showFullPageControl&&p.push(this.fullPageButton=new a.Button({element:this.fullPageButton?a.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.FullPage"),srcRest:H(this.prefixUrl,o.fullpage.REST),srcGroup:H(this.prefixUrl,o.fullpage.GROUP),srcHover:H(this.prefixUrl,o.fullpage.HOVER),srcDown:H(this.prefixUrl,o.fullpage.DOWN),onRelease:h,onFocus:k,onBlur:l})),this.showRotationControl&&(p.push(this.rotateLeftButton=new a.Button({element:this.rotateLeftButton?a.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.RotateLeft"),srcRest:H(this.prefixUrl,o.rotateleft.REST),srcGroup:H(this.prefixUrl,o.rotateleft.GROUP),srcHover:H(this.prefixUrl,o.rotateleft.HOVER),srcDown:H(this.prefixUrl,o.rotateleft.DOWN),onRelease:i,onFocus:k,onBlur:l})),p.push(this.rotateRightButton=new a.Button({element:this.rotateRightButton?a.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.RotateRight"),srcRest:H(this.prefixUrl,o.rotateright.REST),srcGroup:H(this.prefixUrl,o.rotateright.GROUP),srcHover:H(this.prefixUrl,o.rotateright.HOVER),srcDown:H(this.prefixUrl,o.rotateright.DOWN),onRelease:j,onFocus:k,onBlur:l}))),q&&(this.buttons=new a.ButtonGroup({buttons:p,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",a.delegate(this,P)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:a.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||a.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(a){return this.tileSources&&a>=0&&a<this.tileSources.length&&(this.raiseEvent("page",{page:a}),this._sequenceIndex=a,this._updateSequenceButtons(a),this.open(this.tileSources[a]),this.referenceStrip&&this.referenceStrip.setFocus(a)),this},addOverlay:function(b,c,d,e){var h;if(h=a.isPlainObject(b)?b:{element:b,location:c,placement:d,onDraw:e},b=a.getElement(h.element),g(this.currentOverlays,b)>=0)return this;var i=f(this,h);return this.currentOverlays.push(i),i.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:b,location:h.location,placement:h.placement}),this},updateOverlay:function(c,d,e){var f;return c=a.getElement(c),f=g(this.currentOverlays,c),f>=0&&(this.currentOverlays[f].update(d,e),b[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:c,location:d,placement:e})),this},removeOverlay:function(c){var d;return c=a.getElement(c),d=g(this.currentOverlays,c),d>=0&&(this.currentOverlays[d].destroy(),this.currentOverlays.splice(d,1),b[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:c})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return b[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(b){var c;return b=a.getElement(b),c=g(this.currentOverlays,b),c>=0?this.currentOverlays[c]:null},_updateSequenceButtons:function(a){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==a?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(a>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(b){this._hideMessage();var c=a.makeNeutralElement("div");c.appendChild(document.createTextNode(b)),this.messageDiv=a.makeCenteredNode(c),a.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var a=this.messageDiv;a&&(a.parentNode.removeChild(a),delete this.messageDiv)},gestureSettingsByDeviceType:function(a){switch(a){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var a,b=this.currentOverlays.length;for(a=0;a<b;a++)this.currentOverlays[a].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]}})}(OpenSeadragon),function(a){function b(a){a.quick&&this.viewer.viewport&&(this.viewer.viewport.panTo(this.viewport.pointFromPixel(a.position)),this.viewer.viewport.applyConstraints())}function c(a){this.viewer.viewport&&(this.panHorizontal||(a.delta.x=0),this.panVertical||(a.delta.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(a.delta)))}function d(a){a.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function e(a){return this.viewer.raiseEvent("navigator-scroll",{tracker:a.eventSource,position:a.position,scroll:a.scroll,shift:a.shift,originalEvent:a.originalEvent}),!1}function f(a,b){a.style.webkitTransform="rotate("+b+"deg)",a.style.mozTransform="rotate("+b+"deg)",a.style.msTransform="rotate("+b+"deg)",a.style.oTransform="rotate("+b+"deg)",a.style.transform="rotate("+b+"deg)"}a.Navigator=function(g){function l(a){f(i.displayRegionContainer,a),f(i.displayRegion,-a),i.viewport.setRotation(a)}var j,k,h=g.viewer,i=this;if(g.id?(this.element=document.getElementById(g.id),g.controlOptions={anchor:a.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(g.id="navigator-"+a.now(),this.element=a.makeNeutralElement("div"),g.controlOptions={anchor:a.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:g.autoFade},g.position&&("BOTTOM_RIGHT"==g.position?g.controlOptions.anchor=a.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==g.position?g.controlOptions.anchor=a.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==g.position?g.controlOptions.anchor=a.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==g.position?g.controlOptions.anchor=a.ControlAnchor.TOP_LEFT:"ABSOLUTE"==g.position&&(g.controlOptions.anchor=a.ControlAnchor.ABSOLUTE,g.controlOptions.top=g.top,g.controlOptions.left=g.left,g.controlOptions.height=g.height,g.controlOptions.width=g.width))),this.element.id=g.id,this.element.className+=" navigator",g=a.extend(!0,{sizeRatio:a.DEFAULT_SETTINGS.navigatorSizeRatio},g,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:g.autoResize,minZoomImageRatio:1}),g.minPixelRatio=this.minPixelRatio=h.minPixelRatio,a.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new a.Point(1,1),this.totalBorderWidths=new a.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),g.controlOptions.anchor!=a.ControlAnchor.NONE&&function(a,b){a.margin="0px",a.border=b+"px solid #555",a.padding="0px",a.background="#000",a.opacity=.8,a.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=a.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(a,b){a.position="relative",a.top="0px",a.left="0px",a.fontSize="0px",a.overflow="hidden",a.border=b+"px solid #900",a.margin="0px",a.padding="0px",a.background="transparent",a.float="left",a.cssFloat="left",a.styleFloat="left",a.zIndex=999999999,a.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=a.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",h.addControl(this.element,g.controlOptions),this._resizeWithViewer=g.controlOptions.anchor!=a.ControlAnchor.ABSOLUTE&&g.controlOptions.anchor!=a.ControlAnchor.NONE,this._resizeWithViewer&&(g.width&&g.height?(this.element.style.height="number"==typeof g.height?g.height+"px":g.height,this.element.style.width="number"==typeof g.width?g.width+"px":g.width):(j=a.getElementSize(h.element),this.element.style.height=Math.round(j.y*g.sizeRatio)+"px",this.element.style.width=Math.round(j.x*g.sizeRatio)+"px",this.oldViewerSize=j),k=a.getElementSize(this.element),this.elementArea=k.x*k.y),this.oldContainerSize=new a.Point(0,0),a.Viewer.apply(this,[g]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),g.navigatorRotate){l(g.viewer.viewport?g.viewer.viewport.getRotation():g.viewer.degrees||0),g.viewer.addHandler("rotate",function(a){l(a.degrees)})}this.innerTracker.destroy(),this.innerTracker=new a.MouseTracker({element:this.element,dragHandler:a.delegate(this,c),clickHandler:a.delegate(this,b),releaseHandler:a.delegate(this,d),scrollHandler:a.delegate(this,e)}),this.addHandler("reset-size",function(){i.viewport&&i.viewport.goHome(!0)}),h.world.addHandler("item-index-change",function(a){var b=i.world.getItemAt(a.previousIndex);i.world.setItemIndex(b,a.newIndex)}),h.world.addHandler("remove-item",function(a){var b=a.item,c=i._getMatchingItem(b);c&&i.world.removeItem(c)}),this.update(h.viewport)},a.extend(a.Navigator.prototype,a.EventSource.prototype,a.Viewer.prototype,{updateSize:function(){if(this.viewport){var b=new a.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);b.equals(this.oldContainerSize)||(this.viewport.resize(b,!0),this.viewport.goHome(!0),this.oldContainerSize=b,this.drawer.clear(),this.world.draw())}},update:function(b){var c,d,e,f,g,h;if(c=a.getElementSize(this.viewer.element),this._resizeWithViewer&&c.x&&c.y&&!c.equals(this.oldViewerSize)&&(this.oldViewerSize=c,this.maintainSizeRatio||!this.elementArea?(d=c.x*this.sizeRatio,e=c.y*this.sizeRatio):(d=Math.sqrt(this.elementArea*(c.x/c.y)),e=this.elementArea/d),this.element.style.width=Math.round(d)+"px",this.element.style.height=Math.round(e)+"px",this.elementArea||(this.elementArea=d*e),this.updateSize()),b&&this.viewport){f=b.getBoundsNoRotate(!0),g=this.viewport.pixelFromPointNoRotate(f.getTopLeft(),!1),h=this.viewport.pixelFromPointNoRotate(f.getBottomRight(),!1).minus(this.totalBorderWidths);var i=this.displayRegion.style;i.display=this.world.getItemCount()?"block":"none",i.top=Math.round(g.y)+"px",i.left=Math.round(g.x)+"px";var j=Math.abs(g.x-h.x),k=Math.abs(g.y-h.y);i.width=Math.round(Math.max(j,0))+"px",i.height=Math.round(Math.max(k,0))+"px"}},addTiledImage:function(b){var c=this,d=b.originalTiledImage;delete b.original;var e=a.extend({},b,{success:function(a){var b=a.item;b._originalForNavigator=d,c._matchBounds(b,d,!0),d.addHandler("bounds-change",function(){c._matchBounds(b,d)})}});return a.Viewer.prototype.addTiledImage.apply(this,[e])},_getMatchingItem:function(a){for(var c,b=this.world.getItemCount(),d=0;d<b;d++)if(c=this.world.getItemAt(d),c._originalForNavigator===a)return c;return null},_matchBounds:function(a,b,c){var d=b.getBounds();a.setPosition(d.getTopLeft(),c),a.setWidth(d.width,c)}})}(OpenSeadragon),function(a){var b={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right"}};a.extend(a,{getString:function(c){var h,d=c.split("."),e=null,f=arguments,g=b;for(h=0;h<d.length-1;h++)g=g[d[h]]||{};return e=g[d[h]],"string"!=typeof e&&(a.console.debug("Untranslated source string:",c),e=""),e.replace(/\{\d+\}/g,function(a){var b=parseInt(a.match(/\d+/),10)+1;return b<f.length?f[b]:""})},setString:function(a,c){var f,d=a.split("."),e=b;for(f=0;f<d.length-1;f++)e[d[f]]||(e[d[f]]={}),e=e[d[f]];e[d[f]]=c}})}(OpenSeadragon),function(a){a.Point=function(a,b){this.x="number"==typeof a?a:0,this.y="number"==typeof b?b:0},a.Point.prototype={clone:function(){return new a.Point(this.x,this.y)},plus:function(b){return new a.Point(this.x+b.x,this.y+b.y)},minus:function(b){return new a.Point(this.x-b.x,this.y-b.y)},times:function(b){return new a.Point(this.x*b,this.y*b)},divide:function(b){return new a.Point(this.x/b,this.y/b)},negate:function(){return new a.Point(-this.x,-this.y)},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},apply:function(b){return new a.Point(b(this.x),b(this.y))},equals:function(b){return b instanceof a.Point&&this.x===b.x&&this.y===b.y},rotate:function(b,c){c=c||new a.Point(0,0);var d,e;if(b%90==0){var f=b%360;switch(f<0&&(f+=360),f){case 0:d=1,e=0;break;case 90:d=0,e=1;break;case 180:d=-1,e=0;break;case 270:d=0,e=-1}}else{var g=b*Math.PI/180;d=Math.cos(g),e=Math.sin(g)}var h=d*(this.x-c.x)-e*(this.y-c.y)+c.x,i=e*(this.x-c.x)+d*(this.y-c.y)+c.y;return new a.Point(h,i)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(a){function b(b){var e,f,c=b.responseText,d=b.status;if(!b)throw new Error(a.getString("Errors.Security"));if(200!==b.status&&0!==b.status)throw d=b.status,e=404==d?"Not Found":b.statusText,new Error(a.getString("Errors.Status",d,e));if(c.match(/\s*<.*/))try{f=b.responseXML&&b.responseXML.documentElement?b.responseXML:a.parseXml(c)}catch(a){f=b.responseText}else f=c.match(/\s*[\{\[].*/)?a.parseJSON(c):c;return f}a.TileSource=function(b,c,d,e,f,g){var j,k,h=this,i=arguments;if(j=a.isPlainObject(b)?b:{width:i[0],height:i[1],tileSize:i[2],tileOverlap:i[3],minLevel:i[4],maxLevel:i[5]},a.EventSource.call(this),a.extend(!0,this,j),!this.success)for(k=0;k<arguments.length;k++)if(a.isFunction(arguments[k])){this.success=arguments[k];break}this.success&&this.addHandler("ready",function(a){h.success(a)}),"string"==a.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new a.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=j.width&&j.height?j.width/j.height:1,this.dimensions=new a.Point(j.width,j.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=j.tileOverlap?j.tileOverlap:0,this.minLevel=j.minLevel?j.minLevel:0,this.maxLevel=void 0!==j.maxLevel&&null!==j.maxLevel?j.maxLevel:j.width&&j.height?Math.ceil(Math.log(Math.max(j.width,j.height))/Math.log(2)):0,this.success&&a.isFunction(this.success)&&this.success(this))},a.TileSource.prototype={getTileSize:function(b){return a.console.error("[TileSource.getTileSize] is deprecated.Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(a){return this._tileWidth?this._tileWidth:this.getTileSize(a)},getTileHeight:function(a){return this._tileHeight?this._tileHeight:this.getTileSize(a)},getLevelScale:function(a){var c,b={};for(c=0;c<=this.maxLevel;c++)b[c]=1/Math.pow(2,this.maxLevel-c);return this.getLevelScale=function(a){return b[a]},this.getLevelScale(a)},getNumTiles:function(b){var c=this.getLevelScale(b),d=Math.ceil(c*this.dimensions.x/this.getTileWidth(b)),e=Math.ceil(c*this.dimensions.y/this.getTileHeight(b));return new a.Point(d,e)},getPixelRatio:function(b){var c=this.dimensions.times(this.getLevelScale(b)),d=1/c.x,e=1/c.y;return new a.Point(d,e)},getClosestLevel:function(b){var c,d,e;for(c=this.minLevel;c<this.maxLevel&&(e=this.getNumTiles(c),d=new a.Point(Math.floor(b.x/this.getTileWidth(c)),Math.floor(b.y/this.getTileHeight(c))),!(e.x+1>=d.x&&e.y+1>=d.y));c++);return Math.max(0,c-1)},getTileAtPoint:function(b,c){var d=c.times(this.dimensions.x).times(this.getLevelScale(b)),e=Math.floor(d.x/this.getTileWidth(b)),f=Math.floor(d.y/this.getTileHeight(b));return new a.Point(e,f)},getTileBounds:function(b,c,d){var e=this.dimensions.times(this.getLevelScale(b)),f=this.getTileWidth(b),g=this.getTileHeight(b),h=0===c?0:f*c-this.tileOverlap,i=0===d?0:g*d-this.tileOverlap,j=f+(0===c?1:2)*this.tileOverlap,k=g+(0===d?1:2)*this.tileOverlap,l=1/e.x;return j=Math.min(j,e.x-h),k=Math.min(k,e.y-i),new a.Rect(h*l,i*l,j*l,k*l)},getImageInfo:function(c){var e,f,g,h,i,j,k,d=this;c&&(i=c.split("/"),j=i[i.length-1],(k=j.lastIndexOf("."))>-1&&(i[i.length-1]=j.slice(0,k))),f=function(b){"string"==typeof b&&(b=a.parseXml(b));var e=a.TileSource.determineType(d,b,c);if(!e)return void d.raiseEvent("open-failed",{message:"Unable to load TileSource",source:c});h=e.prototype.configure.apply(d,[b,c]),void 0===h.ajaxWithCredentials&&(h.ajaxWithCredentials=d.ajaxWithCredentials),g=new e(h),d.ready=!0,d.raiseEvent("ready",{tileSource:g})},c.match(/\.js$/)?(e=c.split("/").pop().replace(".js",""),a.jsonp({url:c,async:!1,callbackName:e,callback:f})):a.makeAjaxRequest({url:c,withCredentials:this.ajaxWithCredentials,success:function(a){var c=b(a);f(c)},error:function(a,b){var e;try{e="HTTP "+a.status+" attempting to load TileSource"}catch(a){var f;f=void 0!==b&&b.toString?b.toString():"Unknown error",e=f+" attempting to load TileSource"}d.raiseEvent("open-failed",{message:e,source:c})}})},supports:function(a,b){return!1},configure:function(a,b){throw new Error("Method not implemented.")},getTileUrl:function(a,b,c){throw new Error("Method not implemented.")},tileExists:function(a,b,c){var d=this.getNumTiles(a);return a>=this.minLevel&&a<=this.maxLevel&&b>=0&&c>=0&&b<d.x&&c<d.y}},a.extend(!0,a.TileSource.prototype,a.EventSource.prototype),a.TileSource.determineType=function(b,c,d){var e;for(e in OpenSeadragon)if(e.match(/.+TileSource$/)&&a.isFunction(OpenSeadragon[e])&&a.isFunction(OpenSeadragon[e].prototype.supports)&&OpenSeadragon[e].prototype.supports.call(b,c,d))return OpenSeadragon[e];a.console.error("No TileSource was able to open %s %s",d,c)}}(OpenSeadragon),function(a){function b(b,d){if(!d||!d.documentElement)throw new Error(a.getString("Errors.Xml"));var j,k,l,m,n,e=d.documentElement,f=e.localName||e.tagName,g=d.documentElement.namespaceURI,h=null,i=[];if("Image"==f)try{if(m=e.getElementsByTagName("Size")[0],void 0===m&&(m=e.getElementsByTagNameNS(g,"Size")[0]),h={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:e.getAttribute("Url"),Format:e.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(e.getAttribute("Overlap"),10),TileSize:parseInt(e.getAttribute("TileSize"),10),Size:{Height:parseInt(m.getAttribute("Height"),10),Width:parseInt(m.getAttribute("Width"),10)}}},!a.imageFormatSupported(h.Image.Format))throw new Error(a.getString("Errors.ImageFormat",h.Image.Format.toUpperCase()));for(j=e.getElementsByTagName("DisplayRect"),void 0===j&&(j=e.getElementsByTagNameNS(g,"DisplayRect")[0]),n=0;n<j.length;n++)k=j[n],l=k.getElementsByTagName("Rect")[0],void 0===l&&(l=k.getElementsByTagNameNS(g,"Rect")[0]),i.push({Rect:{X:parseInt(l.getAttribute("X"),10),Y:parseInt(l.getAttribute("Y"),10),Width:parseInt(l.getAttribute("Width"),10),Height:parseInt(l.getAttribute("Height"),10),MinLevel:parseInt(k.getAttribute("MinLevel"),10),MaxLevel:parseInt(k.getAttribute("MaxLevel"),10)}});return i.length&&(h.Image.DisplayRect=i),c(b,h)}catch(b){throw b instanceof Error?b:new Error(a.getString("Errors.Dzi"))}else{if("Collection"==f)throw new Error(a.getString("Errors.Dzc"));if("Error"==f){var o=e.getElementsByTagName("Message")[0],p=o.firstChild.nodeValue;throw new Error(p)}}throw new Error(a.getString("Errors.Dzi"))}function c(b,c){var n,o,d=c.Image,e=d.Url,f=d.Format,g=d.Size,h=d.DisplayRect||[],i=parseInt(g.Width,10),j=parseInt(g.Height,10),k=parseInt(d.TileSize,10),l=parseInt(d.Overlap,10),m=[];for(o=0;o<h.length;o++)n=h[o].Rect,m.push(new a.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return a.extend(!0,{width:i,height:j,tileSize:k,tileOverlap:l,minLevel:null,maxLevel:null,tilesUrl:e,fileFormat:f,displayRects:m},c)}a.DziTileSource=function(b,c,d,e,f,g,h,i,j){var k,l,m,n;if(n=a.isPlainObject(b)?b:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=n.tilesUrl,this.fileFormat=n.fileFormat,this.displayRects=n.displayRects,this.displayRects)for(k=this.displayRects.length-1;k>=0;k--)for(l=this.displayRects[k],m=l.minLevel;m<=l.maxLevel;m++)this._levelRects[m]||(this._levelRects[m]=[]),this._levelRects[m].push(l);a.TileSource.apply(this,[n])},a.extend(a.DziTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){var c;return a.Image?c=a.Image.xmlns:a.documentElement&&("Image"!=a.documentElement.localName&&"Image"!=a.documentElement.tagName||(c=a.documentElement.namespaceURI)),"http://schemas.microsoft.com/deepzoom/2008"==c||"http://schemas.microsoft.com/deepzoom/2009"==c},configure:function(d,e){var f;return f=a.isPlainObject(d)?c(this,d):b(this,d),e&&!f.tilesUrl&&(f.tilesUrl=e.replace(/([^\/]+?)(\.(dzi|xml|js))?\/?(\?.*)?$/,"$1_files/"),-1!=e.search(/\.(dzi|xml|js)\?/)?f.queryParams=e.match(/\?.*/):f.queryParams=""),f},getTileUrl:function(a,b,c){return[this.tilesUrl,a,"/",b,"_",c,".",this.fileFormat,this.queryParams].join("")},tileExists:function(a,b,c){var e,f,g,h,i,j,k,d=this._levelRects[a];if(!d||!d.length)return!0;for(k=d.length-1;k>=0;k--)if(e=d[k],!(a<e.minLevel||a>e.maxLevel)&&(f=this.getLevelScale(a),g=e.x*f,h=e.y*f,i=g+e.width*f,j=h+e.height*f,g=Math.floor(g/this.tileSize),h=Math.floor(h/this.tileSize),i=Math.ceil(i/this.tileSize),j=Math.ceil(j/this.tileSize),g<=b&&b<i&&h<=c&&c<j))return!0;return!1}})}(OpenSeadragon),function(a){function b(a){return!(-1!=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json"].indexOf(a[0]))||-1!=a.indexOf("sizeByW")}function c(a){for(var b=[],c=0;c<a.sizes.length;c++)b.push({url:a["@id"]+"/full/"+a.sizes[c].width+",/0/default.jpg",width:a.sizes[c].width,height:a.sizes[c].height});return b.sort(function(a,b){return a.width-b.width})}function d(b){if(!b||!b.documentElement)throw new Error(a.getString("Errors.Xml"));var c=b.documentElement,d=c.tagName,f=null;if("info"==d)try{return f={},e(c,f),f}catch(b){throw b instanceof Error?b:new Error(a.getString("Errors.IIIF"))}throw new Error(a.getString("Errors.IIIF"))}function e(b,c,d){var f,g;if(3==b.nodeType&&d)g=b.nodeValue.trim(),g.match(/^\d*$/)&&(g=Number(g)),c[d]?(a.isArray(c[d])||(c[d]=[c[d]]),c[d].push(g)):c[d]=g;else if(1==b.nodeType)for(f=0;f<b.childNodes.length;f++)e(b.childNodes[f],c,b.nodeName)}a.IIIFTileSource=function(d){if(a.extend(!0,this,d),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(d.tileSizePerScaleFactor={},this.tile_width&&this.tile_height)d.tileWidth=this.tile_width,d.tileHeight=this.tile_height;else if(this.tile_width)d.tileSize=this.tile_width;else if(this.tile_height)d.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)d.tileWidth=this.tiles[0].width,d.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var e=0;e<this.tiles.length;e++)for(var f=0;f<this.tiles[e].scaleFactors.length;f++){var g=this.tiles[e].scaleFactors[f];this.scale_factors.push(g),d.tileSizePerScaleFactor[g]={width:this.tiles[e].width,height:this.tiles[e].height||this.tiles[e].width}}}else if(b(d.profile)){for(var h=Math.min(this.height,this.width),i=[256,512,1024],j=[],k=0;k<i.length;k++)i[k]<=h&&j.push(i[k]);j.length>0?d.tileSize=Math.max.apply(null,j):d.tileSize=h}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,d.levels=c(this),a.extend(!0,d,{width:d.levels[d.levels.length-1].width,height:d.levels[d.levels.length-1].height,tileSize:Math.max(d.height,d.width),tileOverlap:0,minLevel:0,maxLevel:d.levels.length-1}),this.levels=d.levels):a.console.error("Nothing in the info.json to construct image pyramids from");d.maxLevel||this.emulateLegacyImagePyramid||(this.scale_factors?d.maxLevel=Math.floor(Math.pow(Math.max.apply(null,this.scale_factors),.5)):d.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))),a.TileSource.apply(this,[d])},a.extend(a.IIIFTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){return!(!a.protocol||"http://iiif.io/api/image"!=a.protocol)||(!(!a["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=a["@context"]&&"http://iiif.io/api/image/1/context.json"!=a["@context"])||(!(!a.profile||0!==a.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(a.identifier&&a.width&&a.height)||!(!a.documentElement||"info"!=a.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=a.documentElement.namespaceURI))))},configure:function(b,c){if(a.isPlainObject(b))return b["@context"]?b:(b["@context"]="http://iiif.io/api/image/1.0/context.json",b["@id"]=c.replace("/info.json",""),b);var e=d(b);return e["@context"]="http://iiif.io/api/image/1.0/context.json",e["@id"]=c.replace("/info.xml",""),e},getTileWidth:function(b){if(this.emulateLegacyImagePyramid)return a.TileSource.prototype.getTileWidth.call(this,b);var c=Math.pow(2,this.maxLevel-b);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[c]?this.tileSizePerScaleFactor[c].width:this._tileWidth},getTileHeight:function(b){if(this.emulateLegacyImagePyramid)return a.TileSource.prototype.getTileHeight.call(this,b);var c=Math.pow(2,this.maxLevel-b);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[c]?this.tileSizePerScaleFactor[c].height:this._tileHeight},getLevelScale:function(b){if(this.emulateLegacyImagePyramid){var c=NaN;return this.levels.length>0&&b>=this.minLevel&&b<=this.maxLevel&&(c=this.levels[b].width/this.levels[this.maxLevel].width),c}return a.TileSource.prototype.getLevelScale.call(this,b)},getNumTiles:function(b){if(this.emulateLegacyImagePyramid){return this.getLevelScale(b)?new a.Point(1,1):new a.Point(0,0)}return a.TileSource.prototype.getNumTiles.call(this,b)},getTileAtPoint:function(b,c){return this.emulateLegacyImagePyramid?new a.Point(0,0):a.TileSource.prototype.getTileAtPoint.call(this,b,c)},getTileUrl:function(a,b,c){if(this.emulateLegacyImagePyramid){var d=null;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(d=this.levels[a].url),d}var i,j,k,l,m,n,o,p,q,r,s,e="0",f=Math.pow(.5,this.maxLevel-a),g=Math.ceil(this.width*f),h=Math.ceil(this.height*f);return i=this.getTileWidth(a),j=this.getTileHeight(a),k=Math.ceil(i/f),l=Math.ceil(j/f),s=this["@context"].indexOf("/1.0/context.json")>-1||this["@context"].indexOf("/1.1/context.json")>-1||this["@context"].indexOf("/1/context.json")>-1?"native.jpg":"default.jpg",g<i&&h<j?(r=g+",",m="full"):(n=b*k,o=c*l,p=Math.min(k,this.width-n),q=Math.min(l,this.height-o),r=Math.ceil(p*f)+",",m=[n,o,p,q].join(",")),[this["@id"],m,r,e,s].join("/")}})}(OpenSeadragon),function(a){a.OsmTileSource=function(b,c,d,e,f){var g;g=a.isPlainObject(b)?b:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},g.width&&g.height||(g.width=65572864,g.height=65572864),g.tileSize||(g.tileSize=256,g.tileOverlap=0),g.tilesUrl||(g.tilesUrl="http://tile.openstreetmap.org/"),g.minLevel=8,a.TileSource.apply(this,[g])},a.extend(a.OsmTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){return a.type&&"openstreetmaps"==a.type},configure:function(a,b){return a},getTileUrl:function(a,b,c){return this.tilesUrl+(a-8)+"/"+b+"/"+c+".png"}})}(OpenSeadragon),function(a){a.TmsTileSource=function(b,c,d,e,f){var g;g=a.isPlainObject(b)?b:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var j,h=256*Math.ceil(g.width/256),i=256*Math.ceil(g.height/256);j=h>i?h/256:i/256,g.maxLevel=Math.ceil(Math.log(j)/Math.log(2))-1,g.tileSize=256,g.width=h,g.height=i,a.TileSource.apply(this,[g])},a.extend(a.TmsTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){return a.type&&"tiledmapservice"==a.type},configure:function(a,b){return a},getTileUrl:function(a,b,c){var d=this.getNumTiles(a).y-1;return this.tilesUrl+a+"/"+b+"/"+(d-c)+".png"}})}(OpenSeadragon),function(a){function b(b){var d,e,c=[];for(e=0;e<b.length;e++)d=b[e],d.height&&d.width&&d.url&&(d.url.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)(?:\?.*)?$/)||d.mimetype&&d.mimetype.toLowerCase().match(/^.*\/(png|jpg|jpeg|gif)$/))?c.push({url:d.url,width:Number(d.width),height:Number(d.height)}):a.console.error("Unsupported image format: %s",d.url?d.url:"<no URL>");return c.sort(function(a,b){return a.height-b.height})}function c(b,c){if(!c||!c.documentElement)throw new Error(a.getString("Errors.Xml"));var i,j,e=c.documentElement,f=e.tagName,g=null,h=[];if("image"==f)try{for(g={type:e.getAttribute("type"),levels:[]},h=e.getElementsByTagName("level"),j=0;j<h.length;j++)i=h[j],g.levels.push({url:i.getAttribute("url"),width:parseInt(i.getAttribute("width"),10),height:parseInt(i.getAttribute("height"),10)});return d(b,g)}catch(a){throw a instanceof Error?a:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==f)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==f)throw new Error("Error: "+c)}throw new Error("Unknown element "+f)}function d(a,b){return b.levels}a.LegacyTileSource=function(c){var d,e,f;a.isArray(c)&&(d={type:"legacy-image-pyramid",levels:c}),d.levels=b(d.levels),d.levels.length>0?(e=d.levels[d.levels.length-1].width,f=d.levels[d.levels.length-1].height):(e=0,f=0,a.console.error("No supported image formats found")),a.extend(!0,d,{width:e,height:f,tileSize:Math.max(f,e),tileOverlap:0,minLevel:0,maxLevel:d.levels.length>0?d.levels.length-1:0}),a.TileSource.apply(this,[d]),this.levels=d.levels},a.extend(a.LegacyTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){return a.type&&"legacy-image-pyramid"==a.type||a.documentElement&&"legacy-image-pyramid"==a.documentElement.getAttribute("type")},configure:function(b,e){return a.isPlainObject(b)?d(this,b):c(this,b)},getLevelScale:function(a){var b=NaN;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(b=this.levels[a].width/this.levels[this.maxLevel].width),b},getNumTiles:function(b){return this.getLevelScale(b)?new a.Point(1,1):new a.Point(0,0)},getTileAtPoint:function(b,c){return new a.Point(0,0)},getTileUrl:function(a,b,c){var d=null;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(d=this.levels[a].url),d}})}(OpenSeadragon),function(a){a.ImageTileSource=function(b){b=a.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},b),a.TileSource.apply(this,[b])},a.extend(a.ImageTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){return a.type&&"image"===a.type},configure:function(a,b){return a},getImageInfo:function(b){var c=this._image=new Image,d=this;this.crossOriginPolicy&&(c.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(c.useCredentials=this.ajaxWithCredentials),a.addEvent(c,"load",function(){d.width=c.naturalWidth,d.height=c.naturalHeight,d.aspectRatio=d.width/d.height,d.dimensions=new a.Point(d.width,d.height),d._tileWidth=d.width,d._tileHeight=d.height,d.tileOverlap=0,d.minLevel=0,d.levels=d._buildLevels(),d.maxLevel=d.levels.length-1,d.ready=!0,d.raiseEvent("ready",{tileSource:d})}),a.addEvent(c,"error",function(){d.raiseEvent("open-failed",{message:"Error loading image at "+b,source:b})}),c.src=b},getLevelScale:function(a){var b=NaN;return a>=this.minLevel&&a<=this.maxLevel&&(b=this.levels[a].width/this.levels[this.maxLevel].width),b},getNumTiles:function(b){return this.getLevelScale(b)?new a.Point(1,1):new a.Point(0,0)},getTileAtPoint:function(b,c){return new a.Point(0,0)},getTileUrl:function(a,b,c){var d=null;return a>=this.minLevel&&a<=this.maxLevel&&(d=this.levels[a].url),d},getContext2D:function(a,b,c){var d=null;return a>=this.minLevel&&a<=this.maxLevel&&(d=this.levels[a].context2D),d},_buildLevels:function(){var b=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!a.supportsCanvas||!this.useCanvas)return delete this._image,b;var c=this._image.naturalWidth,d=this._image.naturalHeight,e=document.createElement("canvas"),f=e.getContext("2d");if(e.width=c,e.height=d,f.drawImage(this._image,0,0,c,d),b[0].context2D=f,delete this._image,a.isCanvasTainted(e))return b;for(;c>=2&&d>=2;){c=Math.floor(c/2),d=Math.floor(d/2);var g=document.createElement("canvas"),h=g.getContext("2d");g.width=c,g.height=d,h.drawImage(e,0,0,c,d),b.splice(0,0,{context2D:h,width:c,height:d}),e=g,f=h}return b}})}(OpenSeadragon),function(a){a.TileSourceCollection=function(b,c,d,e){a.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(a){function b(b){a.requestAnimationFrame(function(){c(b)})}function c(c){var d,e,f;c.shouldFade&&(d=a.now(),e=d-c.fadeBeginTime,f=1-e/c.fadeLength,f=Math.min(1,f),f=Math.max(0,f),c.imgGroup&&a.setElementOpacity(c.imgGroup,f,!0),f>0&&b(c))}function d(c){c.shouldFade=!0,c.fadeBeginTime=a.now()+c.fadeDelay,window.setTimeout(function(){b(c)},c.fadeDelay)}function e(b){b.shouldFade=!1,b.imgGroup&&a.setElementOpacity(b.imgGroup,1,!0)}function f(b,c){b.element.disabled||(c>=a.ButtonState.GROUP&&b.currentState==a.ButtonState.REST&&(e(b),b.currentState=a.ButtonState.GROUP),c>=a.ButtonState.HOVER&&b.currentState==a.ButtonState.GROUP&&(b.imgHover&&(b.imgHover.style.visibility=""),b.currentState=a.ButtonState.HOVER),c>=a.ButtonState.DOWN&&b.currentState==a.ButtonState.HOVER&&(b.imgDown&&(b.imgDown.style.visibility=""),b.currentState=a.ButtonState.DOWN))}function g(b,c){b.element.disabled||(c<=a.ButtonState.HOVER&&b.currentState==a.ButtonState.DOWN&&(b.imgDown&&(b.imgDown.style.visibility="hidden"),b.currentState=a.ButtonState.HOVER),c<=a.ButtonState.GROUP&&b.currentState==a.ButtonState.HOVER&&(b.imgHover&&(b.imgHover.style.visibility="hidden"),b.currentState=a.ButtonState.GROUP),c<=a.ButtonState.REST&&b.currentState==a.ButtonState.GROUP&&(d(b),b.currentState=a.ButtonState.REST))}a.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},a.Button=function(b){var c=this;a.EventSource.call(this),a.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:a.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:a.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},b),this.element=b.element||a.makeNeutralElement("div"),b.element||(this.imgRest=a.makeTransparentImage(this.srcRest),this.imgGroup=a.makeTransparentImage(this.srcGroup),this.imgHover=a.makeTransparentImage(this.srcHover),this.imgDown=a.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",a.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",a.Browser.vendor==a.BROWSERS.FIREFOX&&a.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=a.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new a.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(b){b.insideElementPressed?(f(c,a.ButtonState.DOWN),c.raiseEvent("enter",{originalEvent:b.originalEvent})):b.buttonDownAny||f(c,a.ButtonState.HOVER)},focusHandler:function(a){this.enterHandler(a),c.raiseEvent("focus",{originalEvent:a.originalEvent})},exitHandler:function(b){g(c,a.ButtonState.GROUP),b.insideElementPressed&&c.raiseEvent("exit",{originalEvent:b.originalEvent})},blurHandler:function(a){this.exitHandler(a),c.raiseEvent("blur",{originalEvent:a.originalEvent})},pressHandler:function(b){f(c,a.ButtonState.DOWN),c.raiseEvent("press",{originalEvent:b.originalEvent})},releaseHandler:function(b){b.insideElementPressed&&b.insideElementReleased?(g(c,a.ButtonState.HOVER),c.raiseEvent("release",{originalEvent:b.originalEvent})):b.insideElementPressed?g(c,a.ButtonState.GROUP):f(c,a.ButtonState.HOVER)},clickHandler:function(a){a.quick&&c.raiseEvent("click",{originalEvent:a.originalEvent})},keyHandler:function(a){return 13!==a.keyCode||(c.raiseEvent("click",{originalEvent:a.originalEvent}),c.raiseEvent("release",{originalEvent:a.originalEvent}),!1)}}),g(this,a.ButtonState.REST)},a.extend(a.Button.prototype,a.EventSource.prototype,{notifyGroupEnter:function(){f(this,a.ButtonState.GROUP)},notifyGroupExit:function(){g(this,a.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,a.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,a.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(a){a.ButtonGroup=function(b){a.extend(!0,this,{buttons:[],clickTimeThreshold:a.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:a.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},b);var e,c=this.buttons.concat([]),d=this;if(this.element=b.element||a.makeNeutralElement("div"),!b.group)for(this.label=a.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),e=0;e<c.length;e++)this.element.appendChild(c[e].element);a.setElementTouchActionNone(this.element),this.tracker=new a.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(a){var b;for(b=0;b<d.buttons.length;b++)d.buttons[b].notifyGroupEnter()},exitHandler:function(a){var b;if(!a.insideElementPressed)for(b=0;b<d.buttons.length;b++)d.buttons[b].notifyGroupExit()}})},a.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(a){a.Rect=function(a,b,c,d,e){this.x="number"==typeof a?a:0,this.y="number"==typeof b?b:0,this.width="number"==typeof c?c:0,this.height="number"==typeof d?d:0,this.degrees="number"==typeof e?e:0,this.degrees=this.degrees%360,this.degrees<0&&(this.degrees+=360);var f,g;this.degrees>=270?(f=this.getTopRight(),this.x=f.x,this.y=f.y,g=this.height,this.height=this.width,this.width=g,this.degrees-=270):this.degrees>=180?(f=this.getBottomRight(),this.x=f.x,this.y=f.y,this.degrees-=180):this.degrees>=90&&(f=this.getBottomLeft(),this.x=f.x,this.y=f.y,g=this.height,this.height=this.width,this.width=g,this.degrees-=90)},a.Rect.fromSummits=function(b,c,d){var e=b.distanceTo(c),f=b.distanceTo(d),g=c.minus(b),h=Math.atan(g.y/g.x);return g.x<0?h+=Math.PI:g.y<0&&(h+=2*Math.PI),new a.Rect(b.x,b.y,e,f,h/Math.PI*180)},a.Rect.prototype={clone:function(){return new a.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new a.Point(this.x,this.y)},getBottomRight:function(){return new a.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new a.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new a.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new a.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new a.Point(this.width,this.height)},equals:function(b){return b instanceof a.Rect&&this.x===b.x&&this.y===b.y&&this.width===b.width&&this.height===b.height&&this.degrees===b.degrees},times:function(b){return new a.Rect(this.x*b,this.y*b,this.width*b,this.height*b,this.degrees)},translate:function(b){return new a.Rect(this.x+b.x,this.y+b.y,this.width,this.height,this.degrees)},union:function(b){var c=this.getBoundingBox(),d=b.getBoundingBox(),e=Math.min(c.x,d.x),f=Math.min(c.y,d.y),g=Math.max(c.x+c.width,d.x+d.width),h=Math.max(c.y+c.height,d.y+d.height);return new a.Rect(e,f,g-e,h-f)},intersection:function(b){function t(b,d,e,f){var g=d.minus(b),h=f.minus(e),i=-h.x*g.y+g.x*h.y;if(0===i)return null;var j=(g.x*(b.y-e.y)-g.y*(b.x-e.x))/i,k=(h.x*(b.y-e.y)-h.y*(b.x-e.x))/i;return-c<=j&&j<=1-c&&-c<=k&&k<=1-c?new a.Point(b.x+k*g.x,b.y+k*g.y):null}var c=1e-10,d=[],e=this.getTopLeft();b.containsPoint(e,c)&&d.push(e);var f=this.getTopRight();b.containsPoint(f,c)&&d.push(f);var g=this.getBottomLeft();b.containsPoint(g,c)&&d.push(g);var h=this.getBottomRight();b.containsPoint(h,c)&&d.push(h);var i=b.getTopLeft();this.containsPoint(i,c)&&d.push(i);var j=b.getTopRight();this.containsPoint(j,c)&&d.push(j);var k=b.getBottomLeft();this.containsPoint(k,c)&&d.push(k);var l=b.getBottomRight();this.containsPoint(l,c)&&d.push(l);for(var m=this._getSegments(),n=b._getSegments(),o=0;o<m.length;o++)for(var p=m[o],q=0;q<n.length;q++){var r=n[q],s=t(p[0],p[1],r[0],r[1]);s&&d.push(s)}if(0===d.length)return null;for(var u=d[0].x,v=d[0].x,w=d[0].y,x=d[0].y,y=1;y<d.length;y++){var z=d[y];z.x<u&&(u=z.x),z.x>v&&(v=z.x),z.y<w&&(w=z.y),z.y>x&&(x=z.y)}return new a.Rect(u,w,v-u,x-w)},_getSegments:function(){var a=this.getTopLeft(),b=this.getTopRight(),c=this.getBottomLeft(),d=this.getBottomRight();return[[a,b],[b,d],[d,c],[c,a]]},rotate:function(b,c){if(0===(b%=360))return this.clone();b<0&&(b+=360),c=c||this.getCenter();var d=this.getTopLeft().rotate(b,c),e=this.getTopRight().rotate(b,c),f=e.minus(d),g=Math.atan(f.y/f.x);return f.x<0?g+=Math.PI:f.y<0&&(g+=2*Math.PI),new a.Rect(d.x,d.y,this.width,this.height,g/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var b=this.getTopLeft(),c=this.getTopRight(),d=this.getBottomLeft(),e=this.getBottomRight(),f=Math.min(b.x,c.x,d.x,e.x),g=Math.max(b.x,c.x,d.x,e.x),h=Math.min(b.y,c.y,d.y,e.y),i=Math.max(b.y,c.y,d.y,e.y);return new a.Rect(f,h,g-f,i-h)},getIntegerBoundingBox:function(){var b=this.getBoundingBox(),c=Math.floor(b.x),d=Math.floor(b.y),e=Math.ceil(b.width+b.x-c),f=Math.ceil(b.height+b.y-d);return new a.Rect(c,d,e,f)},containsPoint:function(a,b){b=b||0;var c=this.getTopLeft(),d=this.getTopRight(),e=this.getBottomLeft(),f=d.minus(c),g=e.minus(c);return(a.x-c.x)*f.x+(a.y-c.y)*f.y>=-b&&(a.x-d.x)*f.x+(a.y-d.y)*f.y<=b&&(a.x-c.x)*g.x+(a.y-c.y)*g.y>=-b&&(a.x-e.x)*g.x+(a.y-e.y)*g.y<=b},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(a){function c(b){var c=Number(this.element.style.marginLeft.replace("px","")),d=Number(this.element.style.marginTop.replace("px","")),f=Number(this.element.style.width.replace("px","")),g=Number(this.element.style.height.replace("px","")),h=a.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-b.delta.x>0?c>-(f-h.x)&&(this.element.style.marginLeft=c+2*b.delta.x+"px",e(this,h.x,c+2*b.delta.x)):-b.delta.x<0&&c<0&&(this.element.style.marginLeft=c+2*b.delta.x+"px",e(this,h.x,c+2*b.delta.x)):-b.delta.y>0?d>-(g-h.y)&&(this.element.style.marginTop=d+2*b.delta.y+"px",e(this,h.y,d+2*b.delta.y)):-b.delta.y<0&&d<0&&(this.element.style.marginTop=d+2*b.delta.y+"px",e(this,h.y,d+2*b.delta.y))),!1}function d(b){var c=Number(this.element.style.marginLeft.replace("px","")),d=Number(this.element.style.marginTop.replace("px","")),f=Number(this.element.style.width.replace("px","")),g=Number(this.element.style.height.replace("px","")),h=a.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?b.scroll>0?c>-(f-h.x)&&(this.element.style.marginLeft=c-60*b.scroll+"px",e(this,h.x,c-60*b.scroll)):b.scroll<0&&c<0&&(this.element.style.marginLeft=c-60*b.scroll+"px",e(this,h.x,c-60*b.scroll)):b.scroll<0?d>h.y-g&&(this.element.style.marginTop=d+60*b.scroll+"px",e(this,h.y,d+60*b.scroll)):b.scroll>0&&d<0&&(this.element.style.marginTop=d+60*b.scroll+"px",e(this,h.y,d+60*b.scroll))),!1}function e(b,c,d){var e,f,g,h,i,j,k;for(e="horizontal"==b.scroll?b.panelWidth:b.panelHeight,f=Math.ceil(c/e)+5,g=Math.ceil((Math.abs(d)+c)/e)+1,f=g-f,f=f<0?0:f,j=f;j<g&&j<b.panels.length;j++)k=b.panels[j],k.activePanel||(h=new a.Viewer({id:k.id,tileSources:[b.viewer.tileSources[j]],element:k,navigatorSizeRatio:b.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0}),h.displayRegion=a.makeNeutralElement("div"),h.displayRegion.id=k.id+"-displayregion",h.displayRegion.className="displayregion",i=h.displayRegion.style,i.position="relative",i.top="0px",i.left="0px",i.fontSize="0px",i.overflow="hidden",i.float="left",i.cssFloat="left",i.styleFloat="left",i.zIndex=999999999,i.cursor="default",i.width=b.panelWidth-4+"px",i.height=b.panelHeight-4+"px",h.displayRegion.innerTracker=new a.MouseTracker({element:h.displayRegion,startDisabled:!0}),k.getElementsByTagName("div")[0].appendChild(h.displayRegion),k.activePanel=!0)}function f(a){var b=a.eventSource.element;return"horizontal"==this.scroll?b.style.marginBottom="0px":b.style.marginLeft="0px",!1}function g(b){var c=b.eventSource.element;return"horizontal"==this.scroll?c.style.marginBottom="-"+a.getElementSize(c).y/2+"px":c.style.marginLeft="-"+a.getElementSize(c).x/2+"px",!1}function h(a){if(a.preventDefaultAction||a.ctrl||a.alt||a.meta)return!0;switch(a.keyCode){case 38:return d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return d.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function i(a){if(a.preventDefaultAction||a.ctrl||a.alt||a.meta)return!0;switch(a.keyCode){case 61:return d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return d.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return d.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}var b={};a.ReferenceStrip=function(j){var n,o,p,k=this,l=j.viewer,m=a.getElementSize(l.element);for(j.id||(j.id="referencestrip-"+a.now(),this.element=a.makeNeutralElement("div"),this.element.id=j.id,this.element.className="referencestrip"),j=a.extend(!0,{sizeRatio:a.DEFAULT_SETTINGS.referenceStripSizeRatio,position:a.DEFAULT_SETTINGS.referenceStripPosition,scroll:a.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:a.DEFAULT_SETTINGS.clickTimeThreshold},j,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),a.extend(this,j),b[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,o=this.element.style,o.marginTop="0px",o.marginRight="0px",o.marginBottom="0px",o.marginLeft="0px",o.left="0px",o.bottom="0px",o.border="0px",o.background="#000",o.position="relative",a.setElementTouchActionNone(this.element),a.setElementOpacity(this.element,.8),this.viewer=l,this.innerTracker=new a.MouseTracker({element:this.element,dragHandler:a.delegate(this,c),scrollHandler:a.delegate(this,d),enterHandler:a.delegate(this,f),exitHandler:a.delegate(this,g),keyDownHandler:a.delegate(this,h),keyHandler:a.delegate(this,i)}),j.width&&j.height?(this.element.style.width=j.width+"px",this.element.style.height=j.height+"px",l.addControl(this.element,{anchor:a.ControlAnchor.BOTTOM_LEFT})):"horizontal"==j.scroll?(this.element.style.width=m.x*j.sizeRatio*l.tileSources.length+12*l.tileSources.length+"px",this.element.style.height=m.y*j.sizeRatio+"px",l.addControl(this.element,{anchor:a.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=m.y*j.sizeRatio*l.tileSources.length+12*l.tileSources.length+"px",this.element.style.width=m.x*j.sizeRatio+"px",l.addControl(this.element,{anchor:a.ControlAnchor.TOP_LEFT})),this.panelWidth=m.x*this.sizeRatio+8,this.panelHeight=m.y*this.sizeRatio+8,this.panels=[],p=0;p<l.tileSources.length;p++)n=a.makeNeutralElement("div"),n.id=this.element.id+"-"+p,n.style.width=k.panelWidth+"px",n.style.height=k.panelHeight+"px",n.style.display="inline",n.style.float="left",n.style.cssFloat="left",n.style.styleFloat="left",n.style.padding="2px",a.setElementTouchActionNone(n),n.innerTracker=new a.MouseTracker({element:n,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(b){b.eventSource.dragging=a.now()},releaseHandler:function(b){var c=b.eventSource,d=c.element.id,e=Number(d.split("-")[2]),f=a.now();b.insideElementPressed&&b.insideElementReleased&&c.dragging&&f-c.dragging<c.clickTimeThreshold&&(c.dragging=null,l.goToPage(e))}}),this.element.appendChild(n),n.activePanel=!1,this.panels.push(n);e(this,"vertical"==this.scroll?m.y:m.x,0),this.setFocus(0)},a.extend(a.ReferenceStrip.prototype,a.EventSource.prototype,a.Viewer.prototype,{setFocus:function(b){var k,c=a.getElement(this.element.id+"-"+b),d=a.getElementSize(this.viewer.canvas),g=Number(this.element.style.width.replace("px","")),h=Number(this.element.style.height.replace("px","")),i=-Number(this.element.style.marginLeft.replace("px","")),j=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==c&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=c,this.currentSelected.style.background="#999","horizontal"==this.scroll?(k=Number(b)*(this.panelWidth+3),k>i+d.x-this.panelWidth?(k=Math.min(k,g-d.x),this.element.style.marginLeft=-k+"px",e(this,d.x,-k)):k<i&&(k=Math.max(0,k-d.x/2),this.element.style.marginLeft=-k+"px",e(this,d.x,-k))):(k=Number(b)*(this.panelHeight+3),k>j+d.y-this.panelHeight?(k=Math.min(k,h-d.y),this.element.style.marginTop=-k+"px",e(this,d.y,-k)):k<j&&(k=Math.max(0,k-d.y/2),this.element.style.marginTop=-k+"px",e(this,d.y,-k))),this.currentPage=b,f.call(this,{eventSource:this.innerTracker}))},update:function(){return!!b[this.id].animating&&(a.console.log("image reference strip update"),!0)},destroy:function(){this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(a){a.DisplayRect=function(b,c,d,e,f,g){a.Rect.apply(this,[b,c,d,e]),this.minLevel=f,this.maxLevel=g},a.extend(a.DisplayRect.prototype,a.Rect.prototype)}(OpenSeadragon),function(a){function b(a,b){return(1-Math.exp(a*-b))/(1-Math.exp(-a))}a.Spring=function(b){var c=arguments;"object"!=typeof b&&(b={initial:c.length&&"number"==typeof c[0]?c[0]:void 0,springStiffness:c.length>1?c[1].springStiffness:5,animationTime:c.length>1?c[1].animationTime:1.5}),a.console.assert("number"==typeof b.springStiffness&&0!==b.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),a.console.assert("number"==typeof b.animationTime&&b.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),b.exponential&&(this._exponential=!0,delete b.exponential),a.extend(!0,this,b),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:a.now()},a.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},a.Spring.prototype={resetTo:function(b){a.console.assert(!this._exponential||0!==b,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=b,this.start.time=this.target.time=this.current.time=a.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(b){a.console.assert(!this._exponential||0!==b,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=b,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(b){this.start.value+=b,this.target.value+=b,this._exponential&&(a.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(b){this._exponential=b,this._exponential&&(a.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=a.now();var c,d;this._exponential?(c=this.start._logValue,d=this.target._logValue):(c=this.start.value,d=this.target.value);var e=this.current.time>=this.target.time?d:c+(d-c)*b(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time));this._exponential?this.current.value=Math.exp(e):this.current.value=e},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(a){function b(b){a.extend(!0,this,{timeout:a.DEFAULT_SETTINGS.timeout,jobId:null},b),this.image=null}function c(a,b,c){var d;a.jobsInProgress--,(!a.jobLimit||a.jobsInProgress<a.jobLimit)&&a.jobQueue.length>0&&(d=a.jobQueue.shift(),d.start(),a.jobsInProgress++),c(b.image,b.errorMsg)}b.prototype={errorMsg:null,start:function(){var a=this;this.image=new Image,!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.onload=function(){a.finish(!0)},this.image.onabort=this.image.onerror=function(){a.errorMsg="Image load aborted",a.finish(!1)},this.jobId=window.setTimeout(function(){a.errorMsg="Image load exceeded timeout",a.finish(!1)},this.timeout),this.image.src=this.src},finish:function(a){this.image.onload=this.image.onerror=this.image.onabort=null,a||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},a.ImageLoader=function(b){a.extend(!0,this,{jobLimit:a.DEFAULT_SETTINGS.imageLoaderLimit,jobQueue:[],jobsInProgress:0},b)},a.ImageLoader.prototype={addJob:function(a){var d=this,e=function(b){c(d,b,a.callback)},f={src:a.src,crossOriginPolicy:a.crossOriginPolicy,callback:e,abort:a.abort},g=new b(f);!this.jobLimit||this.jobsInProgress<this.jobLimit?(g.start(),this.jobsInProgress++):this.jobQueue.push(g)},clear:function(){for(var a=0;a<this.jobQueue.length;a++){var b=this.jobQueue[a];"function"==typeof b.abort&&b.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(a){a.Tile=function(a,b,c,d,e,f,g){this.level=a,this.x=b,this.y=c,this.bounds=d,this.exists=e,this.url=f,this.context2D=g,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.distance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0},a.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(b){return this.cacheImageRecord?this.loaded?(this.element||(this.element=a.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=b&&b.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",void a.setElementOpacity(this.element,this.opacity)):void a.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):void a.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(b,c,d,e){var h,f=this.position.times(a.pixelDensityRatio),g=this.size.times(a.pixelDensityRatio);return this.context2D||this.cacheImageRecord?(h=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&h?(b.save(),b.globalAlpha=this.opacity,"number"==typeof d&&1!==d&&(f=f.times(d),g=g.times(d)),e instanceof a.Point&&(f=f.plus(e)),1===b.globalAlpha&&this._hasTransparencyChannel()&&b.clearRect(f.x+1,f.y+1,g.x-2,g.y-2),c({context:b,tile:this,rendered:h}),b.drawImage(h.canvas,0,0,h.canvas.width,h.canvas.height,f.x,f.y,g.x,g.y),void b.restore()):void a.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):void a.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var b;if(this.cacheImageRecord)b=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return a.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;b=this.context2D}return b.canvas.width/(this.size.x*a.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(b,c,d){var e=Math.max(1,Math.ceil((d.x-c.x)/2)),f=Math.max(1,Math.ceil((d.y-c.y)/2));return new a.Point(e,f).minus(this.position.times(a.pixelDensityRatio).times(b||1).apply(function(a){return a%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(a){a.OverlayPlacement=a.Placement,a.OverlayRotationMode=a.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),a.Overlay=function(b,c,d){var e;e=a.isPlainObject(b)?b:{element:b,location:c,placement:d},this.element=e.element,this.style=e.element.style,this._init(e)},a.Overlay.prototype={_init:function(b){this.location=b.location,this.placement=void 0===b.placement?a.Placement.TOP_LEFT:b.placement,this.onDraw=b.onDraw,this.checkResize=void 0===b.checkResize||b.checkResize,this.width=void 0===b.width?null:b.width,this.height=void 0===b.height?null:b.height,this.rotationMode=b.rotationMode||a.OverlayRotationMode.EXACT,this.location instanceof a.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=a.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new a.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(b,c){var d=a.Placement.properties[this.placement];d&&(d.isHorizontallyCentered?b.x-=c.x/2:d.isRight&&(b.x-=c.x),d.isVerticallyCentered?b.y-=c.y/2:d.isBottom&&(b.y-=c.y))},destroy:function(){var b=this.element,c=this.style;b.parentNode&&(b.parentNode.removeChild(b),b.prevElementParent&&(c.display="none",document.body.appendChild(b))),this.onDraw=null,c.top="",c.left="",c.position="",null!==this.width&&(c.width=""),null!==this.height&&(c.height="");var d=a.getCssPropertyWithVendorPrefix("transformOrigin"),e=a.getCssPropertyWithVendorPrefix("transform");d&&e&&(c[d]="",c[e]="")},drawHTML:function(b,c){var d=this.element;d.parentNode!==b&&(d.prevElementParent=d.parentNode,d.prevNextSibling=d.nextSibling,b.appendChild(d),this.size=a.getElementSize(d));var e=this._getOverlayPositionAndSize(c),f=e.position,g=this.size=e.size,h=e.rotate;if(this.onDraw)this.onDraw(f,g,this.element);else{var i=this.style;i.left=f.x+"px",i.top=f.y+"px",null!==this.width&&(i.width=g.x+"px"),null!==this.height&&(i.height=g.y+"px");var j=a.getCssPropertyWithVendorPrefix("transformOrigin"),k=a.getCssPropertyWithVendorPrefix("transform");j&&k&&(h?(i[j]=this._getTransformOrigin(),i[k]="rotate("+h+"deg)"):(i[j]="",i[k]="")),i.position="absolute","none"!==i.display&&(i.display="block")}},_getOverlayPositionAndSize:function(b){var c=b.pixelFromPoint(this.location,!0),d=this._getSizeInPixels(b);this.adjust(c,d);var e=0;if(b.degrees&&this.rotationMode!==a.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===a.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var f=new a.Rect(c.x,c.y,d.x,d.y),g=this._getBoundingBox(f,b.degrees);c=g.getTopLeft(),d=g.getSize()}else e=b.degrees;return{position:c,size:d,rotate:e}},_getSizeInPixels:function(b){var c=this.size.x,d=this.size.y;if(null!==this.width||null!==this.height){var e=b.deltaPixelsFromPointsNoRotate(new a.Point(this.width||0,this.height||0),!0);null!==this.width&&(c=e.x),null!==this.height&&(d=e.y)}if(this.checkResize&&(null===this.width||null===this.height)){var f=this.size=a.getElementSize(this.element);null===this.width&&(c=f.x),null===this.height&&(d=f.y)}return new a.Point(c,d)},_getBoundingBox:function(a,b){var c=this._getPlacementPoint(a);return a.rotate(b,c).getBoundingBox()},_getPlacementPoint:function(b){var c=new a.Point(b.x,b.y),d=a.Placement.properties[this.placement];return d&&(d.isHorizontallyCentered?c.x+=b.width/2:d.isRight&&(c.x+=b.width),d.isVerticallyCentered?c.y+=b.height/2:d.isBottom&&(c.y+=b.height)),c},_getTransformOrigin:function(){var b="",c=a.Placement.properties[this.placement];return c?(c.isLeft?b="left":c.isRight&&(b="right"),c.isTop?b+=" top":c.isBottom&&(b+=" bottom"),b):b},update:function(b,c){var d=a.isPlainObject(b)?b:{location:b,placement:c};this._init({location:d.location||this.location,placement:void 0!==d.placement?d.placement:this.placement,onDraw:d.onDraw||this.onDraw,checkResize:d.checkResize||this.checkResize,width:void 0!==d.width?d.width:this.width,height:void 0!==d.height?d.height:this.height,rotationMode:d.rotationMode||this.rotationMode})},getBounds:function(b){a.console.assert(b,"A viewport must now be passed to Overlay.getBounds.");var c=this.width,d=this.height;if(null===c||null===d){var e=b.deltaPointsFromPixelsNoRotate(this.size,!0);null===c&&(c=e.x),null===d&&(d=e.y)}var f=this.location.clone();return this.adjust(f,new a.Point(c,d)),this._adjustBoundsForRotation(b,new a.Rect(f.x,f.y,c,d))},_adjustBoundsForRotation:function(b,c){if(!b||0===b.degrees||this.rotationMode===a.OverlayRotationMode.EXACT)return c;if(this.rotationMode===a.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return c;var d=this._getOverlayPositionAndSize(b);return b.viewerElementToViewportRectangle(new a.Rect(d.position.x,d.position.y,d.size.x,d.size.y))}return c.rotate(-b.degrees,this._getPlacementPoint(c))}}}(OpenSeadragon),function(a){a.Drawer=function(b){a.console.assert(b.viewer,"[Drawer] options.viewer is required");var c=arguments;if(a.isPlainObject(b)||(b={source:c[0],viewport:c[1],element:c[2]}),a.console.assert(b.viewport,"[Drawer] options.viewport is required"),a.console.assert(b.element,"[Drawer] options.element is required"),b.source&&a.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=b.viewer,this.viewport=b.viewport,this.debugGridColor=b.debugGridColor||a.DEFAULT_SETTINGS.debugGridColor,b.opacity&&a.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=a.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=a.getElement(b.element),this.canvas=a.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var d=this._calculateCanvasSize();this.canvas.width=d.x,this.canvas.height=d.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",a.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas)},a.Drawer.prototype={addOverlay:function(b,c,d,e){return a.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(b,c,d,e),this},updateOverlay:function(b,c,d){return a.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(b,c,d),this},removeOverlay:function(b){return a.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(b),this},clearOverlays:function(){return a.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},setOpacity:function(b){a.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var c=this.viewer.world,d=0;d<c.getItemCount();d++)c.getItemAt(d).setOpacity(b);return this},getOpacity:function(){a.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var b=this.viewer.world,c=0,d=0;d<b.getItemCount();d++){var e=b.getItemAt(d).getOpacity();e>c&&(c=e)}return c},needsUpdate:function(){return a.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return a.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return a.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return a.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var a=this._calculateCanvasSize();if((this.canvas.width!=a.x||this.canvas.height!=a.y)&&(this.canvas.width=a.x,this.canvas.height=a.y,null!==this.sketchCanvas)){var b=this._calculateSketchCanvasSize();this.sketchCanvas.width=b.x,this.sketchCanvas.height=b.y}this._clear()}},_clear:function(a,b){if(this.useCanvas){var c=this._getContext(a);if(b)c.clearRect(b.x,b.y,b.width,b.height);else{var d=c.canvas;c.clearRect(0,0,d.width,d.height)}}},viewportToDrawerRectangle:function(b){var c=this.viewport.pixelFromPointNoRotate(b.getTopLeft(),!0),d=this.viewport.deltaPixelsFromPointsNoRotate(b.getSize(),!0);return new a.Rect(c.x*a.pixelDensityRatio,c.y*a.pixelDensityRatio,d.x*a.pixelDensityRatio,d.y*a.pixelDensityRatio)},drawTile:function(b,c,d,e,f){if(a.console.assert(b,"[Drawer.drawTile] tile is required"),a.console.assert(c,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var g=this._getContext(d);e=e||1,b.drawCanvas(g,c,e,f)}else b.drawHTML(this.canvas)},_getContext:function(a){var b=this.context;if(a){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var c=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=c.x,this.sketchCanvas.height=c.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var d=this;this.viewer.addHandler("rotate",function a(){d.viewer.removeHandler("rotate",a);var b=d._calculateSketchCanvasSize();d.sketchCanvas.width=b.x,d.sketchCanvas.height=b.y})}}b=this.sketchContext}return b},saveContext:function(a){this.useCanvas&&this._getContext(a).save()},restoreContext:function(a){this.useCanvas&&this._getContext(a).restore()},setClip:function(a,b){if(this.useCanvas){var c=this._getContext(b);c.beginPath(),c.rect(a.x,a.y,a.width,a.height),c.clip()}},drawRectangle:function(a,b,c){if(this.useCanvas){var d=this._getContext(c);d.save(),d.fillStyle=b,d.fillRect(a.x,a.y,a.width,a.height),d.restore()}},blendSketch:function(b,c,d,e){var f=b;if(a.isPlainObject(f)||(f={opacity:b,scale:c,translate:d,compositeOperation:e}),this.useCanvas&&this.sketchCanvas){b=f.opacity,e=f.compositeOperation;var g=f.bounds;if(this.context.save(),this.context.globalAlpha=b,e&&(this.context.globalCompositeOperation=e),g)this.context.drawImage(this.sketchCanvas,g.x,g.y,g.width,g.height,g.x,g.y,g.width,g.height);else{c=f.scale||1,d=f.translate;var h=d instanceof a.Point?d:new a.Point(0,0),i=0,j=0;if(d){var k=this.sketchCanvas.width-this.canvas.width,l=this.sketchCanvas.height-this.canvas.height;i=Math.round(k/2),j=Math.round(l/2)}this.context.drawImage(this.sketchCanvas,h.x-i*c,h.y-j*c,(this.canvas.width+2*i)*c,(this.canvas.height+2*j)*c,-i,-j,this.canvas.width+2*i,this.canvas.height+2*j)}this.context.restore()}},drawDebugInfo:function(b,c,d){if(this.useCanvas){var e=this.context;e.save(),e.lineWidth=2*a.pixelDensityRatio,e.font="small-caps bold "+13*a.pixelDensityRatio+"px arial",e.strokeStyle=this.debugGridColor,e.fillStyle=this.debugGridColor,0!==this.viewport.degrees&&this._offsetForRotation(this.viewport.degrees),e.strokeRect(b.position.x*a.pixelDensityRatio,b.position.y*a.pixelDensityRatio,b.size.x*a.pixelDensityRatio,b.size.y*a.pixelDensityRatio);var f=(b.position.x+b.size.x/2)*a.pixelDensityRatio,g=(b.position.y+b.size.y/2)*a.pixelDensityRatio;e.translate(f,g),e.rotate(Math.PI/180*-this.viewport.degrees),e.translate(-f,-g),0===b.x&&0===b.y&&(e.fillText("Zoom: "+this.viewport.getZoom(),b.position.x*a.pixelDensityRatio,(b.position.y-30)*a.pixelDensityRatio),e.fillText("Pan: "+this.viewport.getBounds().toString(),b.position.x*a.pixelDensityRatio,(b.position.y-20)*a.pixelDensityRatio)),e.fillText("Level: "+b.level,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+20)*a.pixelDensityRatio),e.fillText("Column: "+b.x,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+30)*a.pixelDensityRatio),e.fillText("Row: "+b.y,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+40)*a.pixelDensityRatio),e.fillText("Order: "+d+" of "+c,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+50)*a.pixelDensityRatio),e.fillText("Size: "+b.size.toString(),(b.position.x+10)*a.pixelDensityRatio,(b.position.y+60)*a.pixelDensityRatio),e.fillText("Position: "+b.position.toString(),(b.position.x+10)*a.pixelDensityRatio,(b.position.y+70)*a.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),e.restore()}},debugRect:function(b){if(this.useCanvas){var c=this.context;c.save(),c.lineWidth=2*a.pixelDensityRatio,c.strokeStyle=this.debugGridColor,c.fillStyle=this.debugGridColor,c.strokeRect(b.x*a.pixelDensityRatio,b.y*a.pixelDensityRatio,b.width*a.pixelDensityRatio,b.height*a.pixelDensityRatio),c.restore()}},getCanvasSize:function(b){var c=this._getContext(b).canvas;return new a.Point(c.width,c.height)},_offsetForRotation:function(a,b){var c=this.canvas.width/2,d=this.canvas.height/2,e=this._getContext(b);e.save(),e.translate(c,d),e.rotate(Math.PI/180*a),e.translate(-c,-d)},_restoreRotationChanges:function(a){this._getContext(a).restore()},_calculateCanvasSize:function(){var b=a.pixelDensityRatio,c=this.viewport.getContainerSize();return{x:c.x*b,y:c.y*b}},_calculateSketchCanvasSize:function(){var a=this._calculateCanvasSize();if(0===this.viewport.getRotation())return a;var b=Math.ceil(Math.sqrt(a.x*a.x+a.y*a.y));return{x:b,y:b}}}}(OpenSeadragon),function(a){a.Viewport=function(b){var c=arguments;c.length&&c[0]instanceof a.Point&&(b={containerSize:c[0],contentSize:c[1],config:c[2]}),b.config&&(a.extend(!0,b,b.config),delete b.config),this._margins=a.extend({left:0,top:0,right:0,bottom:0},b.margins||{}),delete b.margins,a.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:a.DEFAULT_SETTINGS.springStiffness,animationTime:a.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:a.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:a.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:a.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:a.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:a.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:a.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:a.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:a.DEFAULT_SETTINGS.maxZoomLevel,degrees:a.DEFAULT_SETTINGS.degrees,homeFillsViewer:a.DEFAULT_SETTINGS.homeFillsViewer},b),this._updateContainerInnerSize(),this.centerSpringX=new a.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new a.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new a.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new a.Rect(0,0,1,1),1),this.goHome(!0),this.update()},a.Viewport.prototype={resetContentSize:function(b){return a.console.assert(b,"[Viewport.resetContentSize] contentSize is required"),a.console.assert(b instanceof a.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),a.console.assert(b.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),a.console.assert(b.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new a.Rect(0,0,1,b.y/b.x),b.x),this},setHomeBounds:function(b,c){a.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(b,c)},_setContentBounds:function(b,c){a.console.assert(b,"[Viewport._setContentBounds] bounds is required"),a.console.assert(b instanceof a.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),a.console.assert(b.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),a.console.assert(b.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=b.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(c),this._contentBounds=b.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(c),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:c,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var a=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?a>=1?a:1:a>=1?1:a)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var b=this._contentBounds.getCenter(),c=1/this.getHomeZoom(),d=c/this.getAspectRatio();return new a.Rect(b.x-c/2,b.y-d/2,c,d)},goHome:function(a){return this.viewer&&this.viewer.raiseEvent("home",{immediately:a}),this.fitBounds(this.getHomeBounds(),a)},getMinZoom:function(){var a=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*a},getMaxZoom:function(){var a=this.maxZoomLevel;return a||(a=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,a/=this._contentBounds.width),Math.max(a,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new a.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return a.extend({},this._margins)},setMargins:function(b){a.console.assert("object"===a.type(b),"[Viewport.setMargins] margins must be an object"),this._margins=a.extend({left:0,top:0,right:0,bottom:0},b),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(a){return this.getBoundsNoRotate(a).rotate(-this.getRotation())},getBoundsNoRotate:function(b){var c=this.getCenter(b),d=1/this.getZoom(b),e=d/this.getAspectRatio();return new a.Rect(c.x-d/2,c.y-e/2,d,e)},getBoundsWithMargins:function(a){return this.getBoundsNoRotateWithMargins(a).rotate(-this.getRotation(),this.getCenter(a))},getBoundsNoRotateWithMargins:function(a){var b=this.getBoundsNoRotate(a),c=this._containerInnerSize.x*this.getZoom(a);return b.x-=this._margins.left/c,b.y-=this._margins.top/c,b.width+=(this._margins.left+this._margins.right)/c,b.height+=(this._margins.top+this._margins.bottom)/c,b},getCenter:function(b){var e,f,g,h,i,j,k,l,c=new a.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),d=new a.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return b?c:this.zoomPoint?(e=this.pixelFromPoint(this.zoomPoint,!0),f=this.getZoom(),g=1/f,h=g/this.getAspectRatio(),i=new a.Rect(c.x-g/2,c.y-h/2,g,h),j=this._pixelFromPoint(this.zoomPoint,i),k=j.minus(e),l=k.divide(this._containerInnerSize.x*f),d.plus(l)):d},getZoom:function(a){return a?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(a){return Math.max(Math.min(a,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(b,c){var d=new a.Rect(b.x,b.y,b.width,b.height);if(this.wrapHorizontal);else{var e=this.visibilityRatio*d.width,f=d.x+d.width,g=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,h=this._contentBoundsNoRotate.x-f+e,i=g-d.x-e;e>this._contentBoundsNoRotate.width?d.x+=(h+i)/2:i<0?d.x+=i:h>0&&(d.x+=h)}if(this.wrapVertical);else{var j=this.visibilityRatio*d.height,k=d.y+d.height,l=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,m=this._contentBoundsNoRotate.y-k+j,n=l-d.y-j;j>this._contentBoundsNoRotate.height?d.y+=(m+n)/2:n<0?d.y+=n:m>0&&(d.y+=m)}return this.viewer&&this.viewer.raiseEvent("constrain",{immediately:c}),d},applyConstraints:function(a){var b=this.getZoom(),c=this._applyZoomConstraints(b);b!==c&&this.zoomTo(c,this.zoomPoint,a);var d=this.getBoundsNoRotate(),e=this._applyBoundaryConstraints(d,a);return(d.x!==e.x||d.y!==e.y||a)&&this.fitBounds(e.rotate(-this.getRotation()),a),this},ensureVisible:function(a){return this.applyConstraints(a)},_fitBounds:function(b,c){c=c||{};var d=c.immediately||!1,e=c.constraints||!1,f=this.getAspectRatio(),g=b.getCenter(),h=new a.Rect(b.x,b.y,b.width,b.height,b.degrees+this.getRotation()).getBoundingBox();h.getAspectRatio()>=f?h.height=h.width/f:h.width=h.height*f,h.x=g.x-h.width/2,h.y=g.y-h.height/2;var i=1/h.width;if(e){var j=h.getAspectRatio(),k=this._applyZoomConstraints(i);i!==k&&(i=k,h.width=1/i,h.x=g.x-h.width/2,h.height=h.width/j,h.y=g.y-h.height/2),h=this._applyBoundaryConstraints(h,d),g=h.getCenter()}if(d)return this.panTo(g,!0),this.zoomTo(i,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var l=this.getBounds(),m=this.getZoom();if(0===m||Math.abs(i/m-1)<1e-8)return this.zoomTo(i,!0),this.panTo(g,d);h=h.rotate(-this.getRotation());var n=h.getTopLeft().times(i).minus(l.getTopLeft().times(m)).divide(i-m);return this.zoomTo(i,n,d)},fitBounds:function(a,b){return this._fitBounds(a,{immediately:b,constraints:!1})},fitBoundsWithConstraints:function(a,b){return this._fitBounds(a,{immediately:b,constraints:!0})},fitVertically:function(b){var c=new a.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(c,b)},fitHorizontally:function(b){var c=new a.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(c,b)},panBy:function(b,c){var d=new a.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(d.plus(b),c)},panTo:function(a,b){return b?(this.centerSpringX.resetTo(a.x),this.centerSpringY.resetTo(a.y)):(this.centerSpringX.springTo(a.x),this.centerSpringY.springTo(a.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:a,immediately:b}),this},zoomBy:function(a,b,c){return this.zoomTo(this.zoomSpring.target.value*a,b,c)},zoomTo:function(b,c,d){return this.zoomPoint=c instanceof a.Point&&!isNaN(c.x)&&!isNaN(c.y)?c:null,d?this.zoomSpring.resetTo(b):this.zoomSpring.springTo(b),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:b,refPoint:c,immediately:d}),this},setRotation:function(a){return this.viewer&&this.viewer.drawer.canRotate()?(a%=360,a<0&&(a+=360),this.degrees=a,this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:a}),this):this},getRotation:function(){return this.degrees},resize:function(a,b){var e,c=this.getBoundsNoRotate(),d=c;return this.containerSize.x=a.x,this.containerSize.y=a.y,this._updateContainerInnerSize(),b&&(e=a.x/this.containerSize.x,d.width=c.width*e,d.height=d.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:a,maintain:b}),this.fitBounds(d,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new a.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){if(this.zoomPoint){var a=this.pixelFromPoint(this.zoomPoint,!0);this.zoomSpring.update();var b=this.pixelFromPoint(this.zoomPoint,!0),c=b.minus(a),d=this.deltaPointsFromPixels(c,!0);this.centerSpringX.shiftBy(d.x),this.centerSpringY.shiftBy(d.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else this.zoomSpring.update();this.centerSpringX.update(),this.centerSpringY.update();var e=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,e},deltaPixelsFromPointsNoRotate:function(a,b){return a.times(this._containerInnerSize.x*this.getZoom(b))},deltaPixelsFromPoints:function(a,b){return this.deltaPixelsFromPointsNoRotate(a.rotate(this.getRotation()),b)},deltaPointsFromPixelsNoRotate:function(a,b){return a.divide(this._containerInnerSize.x*this.getZoom(b))},deltaPointsFromPixels:function(a,b){return this.deltaPointsFromPixelsNoRotate(a,b).rotate(-this.getRotation())},pixelFromPointNoRotate:function(a,b){return this._pixelFromPointNoRotate(a,this.getBoundsNoRotate(b))},pixelFromPoint:function(a,b){return this._pixelFromPoint(a,this.getBoundsNoRotate(b))},_pixelFromPointNoRotate:function(b,c){return b.minus(c.getTopLeft()).times(this._containerInnerSize.x/c.width).plus(new a.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(a,b){return this._pixelFromPointNoRotate(a.rotate(this.getRotation(),this.getCenter(!0)),b)},pointFromPixelNoRotate:function(b,c){var d=this.getBoundsNoRotate(c);return b.minus(new a.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/d.width).plus(d.getTopLeft())},pointFromPixel:function(a,b){return this.pointFromPixelNoRotate(a,b).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(b,c){var d=this._contentBoundsNoRotate.width;return new a.Point(b*this._contentSizeNoRotate.x/d,c*this._contentSizeNoRotate.x/d)},viewportToImageCoordinates:function(b,c){if(b instanceof a.Point)return this.viewportToImageCoordinates(b.x,b.y);if(this.viewer){var d=this.viewer.world.getItemCount();if(d>1)a.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===d){var e=this.viewer.world.getItemAt(0);return e.viewportToImageCoordinates(b,c,!0)}}return this._viewportToImageDelta(b-this._contentBoundsNoRotate.x,c-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(b,c){var d=this._contentBoundsNoRotate.width;return new a.Point(b/this._contentSizeNoRotate.x*d,c/this._contentSizeNoRotate.x*d)},imageToViewportCoordinates:function(b,c){if(b instanceof a.Point)return this.imageToViewportCoordinates(b.x,b.y);if(this.viewer){var d=this.viewer.world.getItemCount();if(d>1)a.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===d){var e=this.viewer.world.getItemAt(0);return e.imageToViewportCoordinates(b,c,!0)}}var f=this._imageToViewportDelta(b,c);return f.x+=this._contentBoundsNoRotate.x,f.y+=this._contentBoundsNoRotate.y,f},imageToViewportRectangle:function(b,c,d,e){var f=b;if(f instanceof a.Rect||(f=new a.Rect(b,c,d,e)),this.viewer){var g=this.viewer.world.getItemCount();if(g>1)a.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===g){var h=this.viewer.world.getItemAt(0);return h.imageToViewportRectangle(b,c,d,e,!0)}}var i=this.imageToViewportCoordinates(f.x,f.y),j=this._imageToViewportDelta(f.width,f.height);return new a.Rect(i.x,i.y,j.x,j.y,f.degrees)},viewportToImageRectangle:function(b,c,d,e){var f=b;if(f instanceof a.Rect||(f=new a.Rect(b,c,d,e)),this.viewer){var g=this.viewer.world.getItemCount();if(g>1)a.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===g){var h=this.viewer.world.getItemAt(0);return h.viewportToImageRectangle(b,c,d,e,!0)}}var i=this.viewportToImageCoordinates(f.x,f.y),j=this._viewportToImageDelta(f.width,f.height);return new a.Rect(i.x,i.y,j.x,j.y,f.degrees)},viewerElementToImageCoordinates:function(a){var b=this.pointFromPixel(a,!0);return this.viewportToImageCoordinates(b)},imageToViewerElementCoordinates:function(a){var b=this.imageToViewportCoordinates(a);return this.pixelFromPoint(b,!0)},windowToImageCoordinates:function(b){a.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var c=b.minus(a.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(c)},imageToWindowCoordinates:function(b){return a.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(b).plus(a.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(a){return this.pointFromPixel(a,!0)},viewportToViewerElementCoordinates:function(a){return this.pixelFromPoint(a,!0)},viewerElementToViewportRectangle:function(b){return a.Rect.fromSummits(this.pointFromPixel(b.getTopLeft(),!0),this.pointFromPixel(b.getTopRight(),!0),this.pointFromPixel(b.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(b){return a.Rect.fromSummits(this.pixelFromPoint(b.getTopLeft(),!0),this.pixelFromPoint(b.getTopRight(),!0),this.pixelFromPoint(b.getBottomLeft(),!0))},windowToViewportCoordinates:function(b){a.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var c=b.minus(a.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(c)},viewportToWindowCoordinates:function(b){return a.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(b).plus(a.getElementPosition(this.viewer.element))},viewportToImageZoom:function(b){if(this.viewer){var c=this.viewer.world.getItemCount();if(c>1)a.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===c){var d=this.viewer.world.getItemAt(0);return d.viewportToImageZoom(b)}}var e=this._contentSizeNoRotate.x;return b*(this._containerInnerSize.x/e*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(b){if(this.viewer){var c=this.viewer.world.getItemCount();if(c>1)a.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===c){var d=this.viewer.world.getItemAt(0);return d.imageToViewportZoom(b)}}return b*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)}}}(OpenSeadragon),function(a){function b(b){b._needsDraw=!1;for(var d,e,o,q,r,s,t,u,g=null,h=!1,i=a.now(),j=b.viewport.getBoundsWithMargins(!0),l=b.viewport.deltaPixelsFromPointsNoRotate(b.source.getPixelRatio(0),!0).x*b._scaleSpring.current.value,m=Math.max(b.source.minLevel,Math.floor(Math.log(b.minZoomImageRatio)/Math.log(2))),n=Math.min(Math.abs(b.source.maxLevel),Math.abs(Math.floor(Math.log(l/b.minPixelRatio)/Math.log(2))));b.lastDrawn.length>0;)d=b.lastDrawn.pop(),d.beingDrawn=!1;if(!b.wrapHorizontal&&!b.wrapVertical){var v=b.getClippedBounds(!0),w=j.intersection(v);if(null===w)return;j=w}j=j.getBoundingBox(),j.x-=b._xSpring.current.value,j.y-=b._ySpring.current.value;var x=j.getTopLeft(),y=j.getBottomRight();if((b.wrapHorizontal||!(y.x<0||x.x>b._worldWidthCurrent))&&(b.wrapVertical||!(y.y<0||x.y>b._worldHeightCurrent))){b.wrapHorizontal||(x.x=Math.max(x.x,0),y.x=Math.min(y.x,b._worldWidthCurrent)),b.wrapVertical||(x.y=Math.max(x.y,0),y.y=Math.min(y.y,b._worldHeightCurrent)),m=Math.min(m,n);var z;for(e=n;e>=m;e--){if(z=!1,o=b.viewport.deltaPixelsFromPointsNoRotate(b.source.getPixelRatio(e),!0).x*b._scaleSpring.current.value,!h&&o>=b.minPixelRatio||e==m)z=!0,h=!0;else if(!h)continue;if(q=b.viewport.deltaPixelsFromPointsNoRotate(b.source.getPixelRatio(e),!1).x*b._scaleSpring.current.value,r=b.viewport.deltaPixelsFromPointsNoRotate(b.source.getPixelRatio(Math.max(b.source.getClosestLevel(b.viewport.containerSize)-1,0)),!1).x*b._scaleSpring.current.value,s=b.immediateRender?1:r,t=Math.min(1,(o-.5)/.5),u=s/Math.abs(s-q),g=c(b,h,z,e,t,u,x,y,i,g),k(b.coverage,e))break}p(b,b.lastDrawn),g&&!g.context2D&&f(b,g,i)}}function c(a,b,c,e,f,g,h,i,j,k){var l,m,o,p,q,r=a.viewport.pixelFromPoint(a.viewport.getCenter());for(a.viewer&&a.viewer.raiseEvent("update-level",{tiledImage:a,havedrawn:b,level:e,opacity:f,visibility:g,topleft:h,bottomright:i,currenttime:j,best:k}),o=a.source.getTileAtPoint(e,h.divide(a._scaleSpring.current.value)),p=a.source.getTileAtPoint(e,i.divide(a._scaleSpring.current.value)),q=a.source.getNumTiles(e),n(a.coverage,e),a.wrapHorizontal||(p.x=Math.min(p.x,q.x-1)),a.wrapVertical||(p.y=Math.min(p.y,q.y-1)),l=o.x;l<=p.x;l++)for(m=o.y;m<=p.y;m++)k=d(a,c,b,l,m,e,f,g,r,q,j,k);return k}function d(a,b,c,d,f,g,k,n,p,q,r,s){var t=e(d,f,g,a.source,a.tilesMatrix,r,q,a._worldWidthCurrent,a._worldHeightCurrent),u=b;if(a.viewer&&a.viewer.raiseEvent("update-tile",{tiledImage:a,tile:t}),m(a.coverage,g,d,f,!1),!t.exists)return s;if(c&&!u&&(l(a.coverage,g,d,f)?m(a.coverage,g,d,f,!0):u=!0),!u)return s;if(i(t,a.source.tileOverlap,a.viewport,p,n,a),!t.loaded)if(t.context2D)h(a,t);else{var v=a._tileCache.getImageRecord(t.url);if(v){var w=v.getImage();h(a,t,w)}}if(t.loaded){j(a,t,d,f,g,k,r)&&(a._needsDraw=!0)}else t.loading||(s=o(s,t));return s}function e(b,c,d,e,f,g,h,i,j){var k,l,m,n,o,p,q;return f[d]||(f[d]={}),f[d][b]||(f[d][b]={}),f[d][b][c]||(k=(h.x+b%h.x)%h.x,l=(h.y+c%h.y)%h.y,m=e.getTileBounds(d,k,l),n=e.tileExists(d,k,l),o=e.getTileUrl(d,k,l),p=e.getContext2D?e.getContext2D(d,k,l):void 0,m.x+=(b-k)/h.x,m.y+=j/i*((c-l)/h.y),f[d][b][c]=new a.Tile(d,b,c,m,n,o,p)),q=f[d][b][c],q.lastTouchTime=g,q}function f(a,b,c){b.loading=!0,a._imageLoader.addJob({src:b.url,crossOriginPolicy:a.crossOriginPolicy,callback:function(d,e){g(a,b,c,d,e)},abort:function(){b.loading=!1}})}function g(b,c,d,e,f){if(!e)return a.console.log("Tile %s failed to load: %s - error: %s",c,c.url,f),b.viewer.raiseEvent("tile-load-failed",{tile:c,tiledImage:b,time:d,message:f}),c.loading=!1,void(c.exists=!1);if(d<b.lastResetTime)return a.console.log("Ignoring tile %s loaded before reset: %s",c,c.url),void(c.loading=!1);var g=function(){var a=Math.ceil(Math.log(b.source.getTileWidth(c.level))/Math.log(2));h(b,c,e,a)};b._midDraw?window.setTimeout(g,1):g()}function h(a,b,c,d){function f(){return e++,g}function g(){0===--e&&(b.loading=!1,b.loaded=!0,b.context2D||a._tileCache.cacheTile({image:c,tile:b,cutoff:d,tiledImage:a}),a._needsDraw=!0)}var e=0;a.viewer.raiseEvent("tile-loaded",{tile:b,tiledImage:a,image:c,getCompletionCallback:f}),f()()}function i(b,c,d,e,f,g){var h=b.bounds.getTopLeft();h.x*=g._scaleSpring.current.value,h.y*=g._scaleSpring.current.value,h.x+=g._xSpring.current.value,h.y+=g._ySpring.current.value;var i=b.bounds.getSize();i.x*=g._scaleSpring.current.value,i.y*=g._scaleSpring.current.value;var j=d.pixelFromPointNoRotate(h,!0),k=d.pixelFromPointNoRotate(h,!1),l=d.deltaPixelsFromPointsNoRotate(i,!0),m=d.deltaPixelsFromPointsNoRotate(i,!1),n=k.plus(m.divide(2)),o=e.distanceTo(n);c||(l=l.plus(new a.Point(1,1))),b.position=j,b.size=l,b.distance=o,b.visibility=f}function j(a,b,c,d,e,f,g){var i,j,h=1e3*a.blendTime;if(b.blendStart||(b.blendStart=g),i=g-b.blendStart,j=h?Math.min(1,i/h):1,a.alwaysBlend&&(j*=f),b.opacity=j,a.lastDrawn.push(b),1==j)m(a.coverage,e,c,d,!0),a._hasOpaqueTile=!0;else if(i<h)return!0;return!1}function k(a,b,c,d){var e,f,g,h;if(!a[b])return!1;if(void 0===c||void 0===d){e=a[b];for(g in e)if(e.hasOwnProperty(g)){f=e[g];for(h in f)if(f.hasOwnProperty(h)&&!f[h])return!1}return!0}return void 0===a[b][c]||void 0===a[b][c][d]||!0===a[b][c][d]}function l(a,b,c,d){return void 0===c||void 0===d?k(a,b+1):k(a,b+1,2*c,2*d)&&k(a,b+1,2*c,2*d+1)&&k(a,b+1,2*c+1,2*d)&&k(a,b+1,2*c+1,2*d+1)}function m(b,c,d,e,f){if(!b[c])return void a.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",c);b[c][d]||(b[c][d]={}),b[c][d][e]=f}function n(a,b){a[b]={}}function o(a,b){return a?b.visibility>a.visibility?b:b.visibility==a.visibility&&b.distance<a.distance?b:a:b}function p(b,c){if(0!==c.length){var f,g,d=c[0],e=b.opacity<1||b.compositeOperation&&"source-over"!==b.compositeOperation||!b._isBottomItem()&&d._hasTransparencyChannel(),h=b.viewport.getZoom(!0);b.viewportToImageZoom(h)>b.smoothTileEdgesMinZoom&&!b.iOSDevice&&(e=!0,f=d.getScaleForEdgeSmoothing(),g=d.getTranslationForEdgeSmoothing(f,b._drawer.getCanvasSize(!1),b._drawer.getCanvasSize(!0)));var j;e&&(f||(j=b.viewport.viewportToViewerElementRectangle(b.getClippedBounds(!0)).getIntegerBoundingBox().times(a.pixelDensityRatio)),b._drawer._clear(!0,j)),0===b.viewport.degrees||f||b._drawer._offsetForRotation(b.viewport.degrees,e);var k=!1;if(b._clip){b._drawer.saveContext(e);var l=b.imageToViewportRectangle(b._clip,!0),m=b._drawer.viewportToDrawerRectangle(l);f&&(m=m.times(f)),g&&(m=m.translate(g)),b._drawer.setClip(m,e),k=!0}if(b.placeholderFillStyle&&!1===b._hasOpaqueTile){var n=b._drawer.viewportToDrawerRectangle(b.getBounds(!0));f&&(n=n.times(f)),g&&(n=n.translate(g));var o=null;o="function"==typeof b.placeholderFillStyle?b.placeholderFillStyle(b,b._drawer.context):b.placeholderFillStyle,b._drawer.drawRectangle(n,o,e)}for(var p=c.length-1;p>=0;p--)d=c[p],b._drawer.drawTile(d,b._drawingHandler,e,f,g),d.beingDrawn=!0,b.viewer&&b.viewer.raiseEvent("tile-drawn",{tiledImage:b,tile:d});if(k&&b._drawer.restoreContext(e),0===b.viewport.degrees||f||b._drawer._restoreRotationChanges(e),e){var r=0!==b.viewport.degrees&&f;r&&b._drawer._offsetForRotation(b.viewport.degrees,!1),b._drawer.blendSketch({opacity:b.opacity,scale:f,translate:g,compositeOperation:b.compositeOperation,bounds:j}),r&&b._drawer._restoreRotationChanges(!1)}q(b,c)}}function q(b,c){if(b.debugMode)for(var d=c.length-1;d>=0;d--){var e=c[d];try{b._drawer.drawDebugInfo(e,c.length,d)}catch(b){a.console.error(b)}}}a.TiledImage=function(b){var c=this;a.console.assert(b.tileCache,"[TiledImage] options.tileCache is required"),a.console.assert(b.drawer,"[TiledImage] options.drawer is required"),a.console.assert(b.viewer,"[TiledImage] options.viewer is required"),a.console.assert(b.imageLoader,"[TiledImage] options.imageLoader is required"),a.console.assert(b.source,"[TiledImage] options.source is required"),a.console.assert(!b.clip||b.clip instanceof a.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),a.EventSource.call(this),this._tileCache=b.tileCache,delete b.tileCache,this._drawer=b.drawer,delete b.drawer,this._imageLoader=b.imageLoader,delete b.imageLoader,b.clip instanceof a.Rect&&(this._clip=b.clip.clone()),delete b.clip;var d=b.x||0;delete b.x;var e=b.y||0;delete b.y,this.normHeight=b.source.dimensions.y/b.source.dimensions.x,this.contentAspectX=b.source.dimensions.x/b.source.dimensions.y;var f=1;b.width?(f=b.width,delete b.width,b.height&&(a.console.error("specifying both width and height to a tiledImage is not supported"),delete b.height)):b.height&&(f=b.height/this.normHeight,delete b.height);var g=b.fitBounds;delete b.fitBounds;var h=b.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete b.fitBoundsPlacement,a.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,springStiffness:a.DEFAULT_SETTINGS.springStiffness,animationTime:a.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:a.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:a.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:a.DEFAULT_SETTINGS.wrapVertical,immediateRender:a.DEFAULT_SETTINGS.immediateRender,blendTime:a.DEFAULT_SETTINGS.blendTime,alwaysBlend:a.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:a.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:a.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:a.DEFAULT_SETTINGS.iOSDevice,debugMode:a.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:a.DEFAULT_SETTINGS.crossOriginPolicy,placeholderFillStyle:a.DEFAULT_SETTINGS.placeholderFillStyle,opacity:a.DEFAULT_SETTINGS.opacity,compositeOperation:a.DEFAULT_SETTINGS.compositeOperation},b),this._xSpring=new a.Spring({initial:d,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new a.Spring({initial:e,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new a.Spring({initial:f,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),g&&this.fitBounds(g,h,!0),this._drawingHandler=function(b){c.viewer.raiseEvent("tile-drawing",a.extend({tiledImage:c},b))}},a.extend(a.TiledImage.prototype,a.EventSource.prototype,{needsDraw:function(){return this._needsDraw},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=a.now(),this._needsDraw=!0},update:function(){var a=this._xSpring.current.value,b=this._ySpring.current.value,c=this._scaleSpring.current.value;return this._xSpring.update(),this._ySpring.update(),this._scaleSpring.update(),(this._xSpring.current.value!==a||this._ySpring.current.value!==b||this._scaleSpring.current.value!==c)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity&&(this._midDraw=!0,b(this),this._midDraw=!1)},destroy:function(){this.reset()},getBounds:function(b){return b?new a.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new a.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return a.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(b){var c=this.getBounds(b);if(this._clip){var d=this._worldWidthCurrent/this.source.dimensions.x,e=this._clip.times(d);c=new a.Rect(c.x+e.x,c.y+e.y,e.width,e.height)}return c},getContentSize:function(){return new a.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(b,c,d){var e=d?this._scaleSpring.current.value:this._scaleSpring.target.value;return new a.Point(b*(this.source.dimensions.x/e),c*(this.source.dimensions.y*this.contentAspectX/e))},viewportToImageCoordinates:function(b,c,d){return b instanceof a.Point&&(d=c,c=b.y,b=b.x),d?this._viewportToImageDelta(b-this._xSpring.current.value,c-this._ySpring.current.value):this._viewportToImageDelta(b-this._xSpring.target.value,c-this._ySpring.target.value)},_imageToViewportDelta:function(b,c,d){var e=d?this._scaleSpring.current.value:this._scaleSpring.target.value;return new a.Point(b/this.source.dimensions.x*e,c/this.source.dimensions.y/this.contentAspectX*e)},imageToViewportCoordinates:function(b,c,d){b instanceof a.Point&&(d=c,c=b.y,b=b.x);var e=this._imageToViewportDelta(b,c);return d?(e.x+=this._xSpring.current.value,e.y+=this._ySpring.current.value):(e.x+=this._xSpring.target.value,e.y+=this._ySpring.target.value),e},imageToViewportRectangle:function(b,c,d,e,f){var g=b;g instanceof a.Rect?f=c:g=new a.Rect(b,c,d,e);var h=this.imageToViewportCoordinates(g.getTopLeft(),f),i=this._imageToViewportDelta(g.width,g.height,f);return new a.Rect(h.x,h.y,i.x,i.y,g.degrees)},viewportToImageRectangle:function(b,c,d,e,f){var g=b;b instanceof a.Rect?f=c:g=new a.Rect(b,c,d,e);var h=this.viewportToImageCoordinates(g.getTopLeft(),f),i=this._viewportToImageDelta(g.width,g.height,f);return new a.Rect(h.x,h.y,i.x,i.y,g.degrees)},viewerElementToImageCoordinates:function(a){var b=this.viewport.pointFromPixel(a,!0);return this.viewportToImageCoordinates(b)},imageToViewerElementCoordinates:function(a){var b=this.imageToViewportCoordinates(a);return this.viewport.pixelFromPoint(b,!0)},windowToImageCoordinates:function(a){var b=a.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(b)},imageToWindowCoordinates:function(a){return this.imageToViewerElementCoordinates(a).plus(OpenSeadragon.getElementPosition(this.viewer.element))},viewportToImageZoom:function(a){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*a},imageToViewportZoom:function(a){return a/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(a,b){var c=this._xSpring.target.value===a.x&&this._ySpring.target.value===a.y;if(b){if(c&&this._xSpring.current.value===a.x&&this._ySpring.current.value===a.y)return;this._xSpring.resetTo(a.x),this._ySpring.resetTo(a.y),this._needsDraw=!0}else{if(c)return;this._xSpring.springTo(a.x),this._ySpring.springTo(a.y),this._needsDraw=!0}c||this._raiseBoundsChange()},setWidth:function(a,b){this._setScale(a,b)},setHeight:function(a,b){this._setScale(a/this.normHeight,b)},fitBounds:function(b,c,d){c=c||a.Placement.CENTER;var e=a.Placement.properties[c],f=this.contentAspectX,g=0,h=0,i=1,j=1;if(this._clip&&(f=this._clip.getAspectRatio(),i=this._clip.width/this.source.dimensions.x,j=this._clip.height/this.source.dimensions.y,b.getAspectRatio()>f?(g=this._clip.x/this._clip.height*b.height,h=this._clip.y/this._clip.height*b.height):(g=this._clip.x/this._clip.width*b.width,h=this._clip.y/this._clip.width*b.width)),b.getAspectRatio()>f){var k=b.height/j,l=0;e.isHorizontallyCentered?l=(b.width-b.height*f)/2:e.isRight&&(l=b.width-b.height*f),this.setPosition(new a.Point(b.x-g+l,b.y-h),d),this.setHeight(k,d)}else{var m=b.width/i,n=0;e.isVerticallyCentered?n=(b.height-b.width/f)/2:e.isBottom&&(n=b.height-b.width/f),this.setPosition(new a.Point(b.x-g,b.y-h+n),d),this.setWidth(m,d)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(b){a.console.assert(!b||b instanceof a.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),b instanceof a.Rect?this._clip=b.clone():this._clip=null,this._needsDraw=!0},getOpacity:function(){return this.opacity},setOpacity:function(a){this.opacity=a,this._needsDraw=!0},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(a){this.compositeOperation=a,this._needsDraw=!0},_setScale:function(a,b){var c=this._scaleSpring.target.value===a;if(b){if(c&&this._scaleSpring.current.value===a)return;this._scaleSpring.resetTo(a),this._updateForScale(),this._needsDraw=!0}else{if(c)return;this._scaleSpring.springTo(a),this._updateForScale(),this._needsDraw=!0}c||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this}})}(OpenSeadragon),function(a){var b=function(b){a.console.assert(b,"[TileCache.cacheTile] options is required"),a.console.assert(b.tile,"[TileCache.cacheTile] options.tile is required"),a.console.assert(b.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=b.tile,this.tiledImage=b.tiledImage},c=function(b){a.console.assert(b,"[ImageRecord] options is required"),a.console.assert(b.image,"[ImageRecord] options.image is required"),this._image=b.image,this._tiles=[]};c.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var a=document.createElement("canvas");a.width=this._image.width,a.height=this._image.height,this._renderedContext=a.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(b){a.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=b},addTile:function(b){a.console.assert(b,"[ImageRecord.addTile] tile is required"),this._tiles.push(b)},removeTile:function(b){for(var c=0;c<this._tiles.length;c++)if(this._tiles[c]===b)return void this._tiles.splice(c,1);a.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",b)},getTileCount:function(){return this._tiles.length}},a.TileCache=function(b){b=b||{},this._maxImageCacheCount=b.maxImageCacheCount||a.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},a.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(d){a.console.assert(d,"[TileCache.cacheTile] options is required"),a.console.assert(d.tile,"[TileCache.cacheTile] options.tile is required"),a.console.assert(d.tile.url,"[TileCache.cacheTile] options.tile.url is required"),a.console.assert(d.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var e=d.cutoff||0,f=this._tilesLoaded.length,g=this._imagesLoaded[d.tile.url];if(g||(a.console.assert(d.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),g=this._imagesLoaded[d.tile.url]=new c({image:d.image}),this._imagesLoadedCount++),g.addTile(d.tile),d.tile.cacheImageRecord=g,this._imagesLoadedCount>this._maxImageCacheCount){for(var k,l,m,n,o,p,h=null,i=-1,j=null,q=this._tilesLoaded.length-1;q>=0;q--)p=this._tilesLoaded[q],k=p.tile,k.level<=e||k.beingDrawn||(h?(n=k.lastTouchTime,l=h.lastTouchTime,o=k.level,m=h.level,(n<l||n==l&&o>m)&&(h=k,i=q,j=p)):(h=k,i=q,j=p));h&&i>=0&&(this._unloadTile(j),f=i)}this._tilesLoaded[f]=new b({tile:d.tile,tiledImage:d.tiledImage})},clearTilesFor:function(b){a.console.assert(b,"[TileCache.clearTilesFor] tiledImage is required");for(var c,d=0;d<this._tilesLoaded.length;++d)c=this._tilesLoaded[d],c.tiledImage===b&&(this._unloadTile(c),this._tilesLoaded.splice(d,1),d--)},getImageRecord:function(b){return a.console.assert(b,"[TileCache.getImageRecord] url is required"),this._imagesLoaded[b]},_unloadTile:function(b){a.console.assert(b,"[TileCache._unloadTile] tileRecord is required");var c=b.tile,d=b.tiledImage;c.unload(),c.cacheImageRecord=null;var e=this._imagesLoaded[c.url];e.removeTile(c),e.getTileCount()||(e.destroy(),delete this._imagesLoaded[c.url],this._imagesLoadedCount--),d.viewer.raiseEvent("tile-unloaded",{tile:c,tiledImage:d})}}}(OpenSeadragon),function(a){a.World=function(b){var c=this;a.console.assert(b.viewer,"[World] options.viewer is required"),a.EventSource.call(this),this.viewer=b.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(a){c._autoRefigureSizes?c._figureSizes():c._needsSizesFigured=!0},this._figureSizes()},a.extend(a.World.prototype,a.EventSource.prototype,{addItem:function(b,c){if(a.console.assert(b,"[World.addItem] item is required"),a.console.assert(b instanceof a.TiledImage,"[World.addItem] only TiledImages supported at this time"),c=c||{},void 0!==c.index){var d=Math.max(0,Math.min(this._items.length,c.index));this._items.splice(d,0,b)}else this._items.push(b);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,b.addHandler("bounds-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:b})},getItemAt:function(b){return a.console.assert(void 0!==b,"[World.getItemAt] index is required"),this._items[b]},getIndexOfItem:function(b){return a.console.assert(b,"[World.getIndexOfItem] item is required"),a.indexOf(this._items,b)},getItemCount:function(){return this._items.length},setItemIndex:function(b,c){a.console.assert(b,"[World.setItemIndex] item is required"),a.console.assert(void 0!==c,"[World.setItemIndex] index is required");var d=this.getIndexOfItem(b);if(c>=this._items.length)throw new Error("Index bigger than number of layers.");c!==d&&-1!==d&&(this._items.splice(d,1),this._items.splice(c,0,b),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:b,previousIndex:d,newIndex:c}))},removeItem:function(b){a.console.assert(b,"[World.removeItem] item is required");var c=a.indexOf(this._items,b);-1!==c&&(b.removeHandler("bounds-change",this._delegatedFigureSizes),b.destroy(),this._items.splice(c,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(b))},removeAll:function(){this.viewer._cancelPendingImages();for(var a,b=0;b<this._items.length;b++)a=this._items[b],a.removeHandler("bounds-change",this._delegatedFigureSizes),a.destroy();var c=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,b=0;b<c.length;b++)a=c[b],this._raiseRemoveItem(a)},resetItems:function(){for(var a=0;a<this._items.length;a++)this._items[a].reset()},update:function(){for(var a=!1,b=0;b<this._items.length;b++)a=this._items[b].update()||a;return a},draw:function(){for(var a=0;a<this._items.length;a++)this._items[a].draw();this._needsDraw=!1},needsDraw:function(){for(var a=0;a<this._items.length;a++)if(this._items[a].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(a){this._autoRefigureSizes=a,a&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(b){b=b||{};var j,c=b.immediately||!1,d=b.layout||a.DEFAULT_SETTINGS.collectionLayout,e=b.rows||a.DEFAULT_SETTINGS.collectionRows,f=b.columns||a.DEFAULT_SETTINGS.collectionColumns,g=b.tileSize||a.DEFAULT_SETTINGS.collectionTileSize,h=b.tileMargin||a.DEFAULT_SETTINGS.collectionTileMargin,i=g+h;j=!b.rows&&f?f:Math.ceil(this._items.length/e);var m,n,o,p,q,k=0,l=0;this.setAutoRefigureSizes(!1);for(var r=0;r<this._items.length;r++)r&&r%j==0&&("horizontal"===d?(l+=i,k=0):(k+=i,l=0)),m=this._items[r],n=m.getBounds(),o=n.width>n.height?g:g*(n.width/n.height),p=o*(n.height/n.width),q=new a.Point(k+(g-o)/2,l+(g-p)/2),m.setPosition(q,c),m.setWidth(o,c),"horizontal"===d?k+=i:l+=i;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var b=this._homeBounds?this._homeBounds.clone():null,c=this._contentSize?this._contentSize.clone():null,d=this._contentFactor||0;if(this._items.length){var e=this._items[0],f=e.getBounds();this._contentFactor=e.getContentSize().x/f.width;for(var g=e.getClippedBounds(),h=g.x,i=g.y,j=g.x+g.width,k=g.y+g.height,l=1;l<this._items.length;l++)e=this._items[l],f=e.getBounds(),this._contentFactor=Math.max(this._contentFactor,e.getContentSize().x/f.width),g=e.getClippedBounds(),h=Math.min(h,g.x),i=Math.min(i,g.y),j=Math.max(j,g.x+g.width),k=Math.max(k,g.y+g.height);this._homeBounds=new a.Rect(h,i,j-h,k-i),this._contentSize=new a.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new a.Rect(0,0,1,1),this._contentSize=new a.Point(1,1),this._contentFactor=1;this._contentFactor===d&&this._homeBounds.equals(b)&&this._contentSize.equals(c)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(a){this.raiseEvent("remove-item",{item:a})}})}(OpenSeadragon);
